/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*
 This file is part of mscgen_js.

 mscgen_js is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 mscgen_js is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with mscgen_js.  If not, see <http://www.gnu.org/licenses/>.
 */

(function(){var e,t,n;(function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){var n=p.call(arguments,0);return typeof n[0]!="string"&&n.length===1&&n.push(null),s.apply(r,n.concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,m=[],y=typeof n,E;i=i||e;if(y==="undefined"||y==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(d=0;d<t.length;d+=1){p=o(t[d],i),l=p.f;if(l==="require")m[d]=u.require(e);else if(l==="exports")m[d]=u.exports(e),E=!0;else if(l==="module")s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=n?n.apply(a[e],m):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if(typeof e=="string")return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){l=e,l.deps&&s(l.deps,l.callback);if(!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}})(),n("../lib/almond",function(){}),n("parse/xuparser",[],function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,t,n,r,i,s){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=s,this.name="SyntaxError"}function n(e){function Mi(){return e.substring(Ti,xi)}function _i(){return Ti}function Di(){return ji(Ti).line}function Pi(){return ji(Ti).column}function Hi(e){throw Ii(null,[{type:"other",description:e}],Ti)}function Bi(e){throw Ii(e,null,Ti)}function ji(t){function n(t,n,r){var i,s;for(i=n;i<r;i++)s=e.charAt(i),s==="\n"?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):s==="\r"||s==="\u2028"||s==="\u2029"?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return Ni!==t&&(Ni>t&&(Ni=0,Ci={line:1,column:1,seenCR:!1}),n(Ci,Ni,t),Ni=t),Ci}function Fi(e){if(xi<ki)return;xi>ki&&(ki=xi,Li=[]),Li.push(e)}function Ii(n,r,i){function s(e){var t=1;e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});while(t<e.length)e[t-1]===e[t]?e.splice(t,1):t++}function o(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var r=new Array(e.length),i,s,o;for(o=0;o<e.length;o++)r[o]=e[o].description;return i=e.length>1?r.slice(0,-1).join(", ")+" or "+r[e.length-1]:r[0],s=t?'"'+n(t)+'"':"end of input","Expected "+i+" but "+s+" found."}var u=ji(i),a=i<e.length?e.charAt(i):null;return r!==null&&s(r),new t(n!==null?n:o(r,a),r,a,i,u.line,u.column)}function qi(){var t,n,i,s,h,p,d,v,m,g;return t=xi,n=Cs(),n!==r?(i=Ri(),i!==r?(s=Cs(),s!==r?(e.charCodeAt(xi)===123?(h=u,xi++):(h=r,Ai===0&&Fi(a)),h!==r?(p=Cs(),p!==r?(d=Ui(),d!==r?(v=Cs(),v!==r?(e.charCodeAt(xi)===125?(m=f,xi++):(m=r,Ai===0&&Fi(l)),m!==r?(g=Cs(),g!==r?(Ti=t,n=c(n,d),t=n):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o),t}function Ri(){var t;return e.substr(xi,3).toLowerCase()===h?(t=e.substr(xi,3),xi+=3):(t=r,Ai===0&&Fi(p)),t}function Ui(){var e,t,n,i,s;return e=xi,t=xi,n=zi(),n!==r&&(Ti=t,n=v(n)),t=n,t===r&&(t=d),t!==r?(n=xi,i=Vi(),i!==r&&(Ti=n,i=m(i)),n=i,n===r&&(n=d),n!==r?(i=xi,s=Ji(),s!==r&&(Ti=i,s=g(s)),i=s,i===r&&(i=d),i!==r?(t=[t,n,i],e=t):(xi=e,e=o)):(xi=e,e=o)):(xi=e,e=o),e}function zi(){var t,n,i,s,u,a;t=xi,n=xi,i=[],s=xi,u=Wi(),u!==r?(e.charCodeAt(xi)===44?(a=b,xi++):(a=r,Ai===0&&Fi(w)),a!==r?(Ti=s,u=E(u),s=u):(xi=s,s=o)):(xi=s,s=o);while(s!==r)i.push(s),s=xi,u=Wi(),u!==r?(e.charCodeAt(xi)===44?(a=b,xi++):(a=r,Ai===0&&Fi(w)),a!==r?(Ti=s,u=E(u),s=u):(xi=s,s=o)):(xi=s,s=o);return i!==r?(s=xi,u=Wi(),u!==r?(e.charCodeAt(xi)===59?(a=S,xi++):(a=r,Ai===0&&Fi(x)),a!==r?(Ti=s,u=E(u),s=u):(xi=s,s=o)):(xi=s,s=o),s!==r?(i=[i,s],n=i):(xi=n,n=o)):(xi=n,n=o),n!==r&&(Ti=t,n=T(n)),t=n,t}function Wi(){var t,n,i,s,u,a,f,l;return t=xi,n=Cs(),n!==r?(i=Xi(),i!==r?(s=Cs(),s!==r?(e.charCodeAt(xi)===61?(u=N,xi++):(u=r,Ai===0&&Fi(C)),u!==r?(a=Cs(),a!==r?(f=xi,l=ps(),l!==r&&(Ti=f,l=k(l)),f=l,f===r&&(f=xi,l=ks(),l!==r&&(Ti=f,l=L(l)),f=l,f===r&&(f=xi,l=Os(),l!==r&&(Ti=f,l=A(l)),f=l)),f!==r?(l=Cs(),l!==r?(Ti=t,n=O(i,f),t=n):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o),t}function Xi(){var t;return e.substr(xi,6).toLowerCase()===M?(t=e.substr(xi,6),xi+=6):(t=r,Ai===0&&Fi(_)),t===r&&(e.substr(xi,5).toLowerCase()===D?(t=e.substr(xi,5),xi+=5):(t=r,Ai===0&&Fi(P)),t===r&&(e.substr(xi,11).toLowerCase()===H?(t=e.substr(xi,11),xi+=11):(t=r,Ai===0&&Fi(B)),t===r&&(e.substr(xi,12).toLowerCase()===j?(t=e.substr(xi,12),xi+=12):(t=r,Ai===0&&Fi(F)),t===r&&(e.substr(xi,9).toLowerCase()===I?(t=e.substr(xi,9),xi+=9):(t=r,Ai===0&&Fi(q)))))),t}function Vi(){var t,n,i,s,u,a;t=xi,n=xi,i=[],s=xi,u=$i(),u!==r?(e.charCodeAt(xi)===44?(a=b,xi++):(a=r,Ai===0&&Fi(w)),a!==r?(Ti=s,u=R(u),s=u):(xi=s,s=o)):(xi=s,s=o);while(s!==r)i.push(s),s=xi,u=$i(),u!==r?(e.charCodeAt(xi)===44?(a=b,xi++):(a=r,Ai===0&&Fi(w)),a!==r?(Ti=s,u=R(u),s=u):(xi=s,s=o)):(xi=s,s=o);return i!==r?(s=xi,u=$i(),u!==r?(e.charCodeAt(xi)===59?(a=S,xi++):(a=r,Ai===0&&Fi(x)),a!==r?(Ti=s,u=R(u),s=u):(xi=s,s=o)):(xi=s,s=o),s!==r?(i=[i,s],n=i):(xi=n,n=o)):(xi=n,n=o),n!==r&&(Ti=t,n=U(n)),t=n,t}function $i(){var t,n,i,s,u,a,f,l;return Ai++,t=xi,n=Cs(),n!==r?(i=vs(),i!==r?(s=Cs(),s!==r?(u=xi,e.charCodeAt(xi)===91?(a=W,xi++):(a=r,Ai===0&&Fi(X)),a!==r?(f=ls(),f!==r?(e.charCodeAt(xi)===93?(l=V,xi++):(l=r,Ai===0&&Fi($)),l!==r?(Ti=u,a=J(f),u=a):(xi=u,u=o)):(xi=u,u=o)):(xi=u,u=o),u===r&&(u=d),u!==r?(a=Cs(),a!==r?(Ti=t,n=K(i,u),t=n):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o),Ai--,t===r&&(n=r,Ai===0&&Fi(z)),t}function Ji(){var t,n,i,s,u;t=[],n=xi,i=Ki(),i!==r?(s=Cs(),s!==r?(e.charCodeAt(xi)===59?(u=S,xi++):(u=r,Ai===0&&Fi(x)),u!==r?(Ti=n,i=J(i),n=i):(xi=n,n=o)):(xi=n,n=o)):(xi=n,n=o);if(n!==r)while(n!==r)t.push(n),n=xi,i=Ki(),i!==r?(s=Cs(),s!==r?(e.charCodeAt(xi)===59?(u=S,xi++):(u=r,Ai===0&&Fi(x)),u!==r?(Ti=n,i=J(i),n=i):(xi=n,n=o)):(xi=n,n=o)):(xi=n,n=o);else t=o;return t}function Ki(){var t,n,i,s,u,a,f;t=xi,n=xi,i=[],s=xi,u=Qi(),u!==r?(a=Cs(),a!==r?(e.charCodeAt(xi)===44?(f=b,xi++):(f=r,Ai===0&&Fi(w)),f!==r?(Ti=s,u=J(u),s=u):(xi=s,s=o)):(xi=s,s=o)):(xi=s,s=o);while(s!==r)i.push(s),s=xi,u=Qi(),u!==r?(a=Cs(),a!==r?(e.charCodeAt(xi)===44?(f=b,xi++):(f=r,Ai===0&&Fi(w)),f!==r?(Ti=s,u=J(u),s=u):(xi=s,s=o)):(xi=s,s=o)):(xi=s,s=o);return i!==r?(s=xi,u=Qi(),u!==r&&(Ti=s,u=Q(u)),s=u,s!==r?(i=[i,s],n=i):(xi=n,n=o)):(xi=n,n=o),n!==r&&(Ti=t,n=G(n)),t=n,t}function Qi(){var e;return e=Gi(),e===r&&(e=ts()),e}function Gi(){var t,n,i,s,u,a;return t=xi,n=xi,i=Yi(),i!==r&&(Ti=n,i=J(i)),n=i,n===r&&(n=xi,i=es(),i!==r&&(Ti=n,i=J(i)),n=i,n===r&&(n=xi,i=Zi(),i!==r&&(Ti=n,i=J(i)),n=i)),n!==r?(i=xi,e.charCodeAt(xi)===91?(s=W,xi++):(s=r,Ai===0&&Fi(X)),s!==r?(u=ls(),u!==r?(e.charCodeAt(xi)===93?(a=V,xi++):(a=r,Ai===0&&Fi($)),a!==r?(Ti=i,s=Y(u),i=s):(xi=i,i=o)):(xi=i,i=o)):(xi=i,i=o),i===r&&(i=d),i!==r?(Ti=t,n=Z(n,i),t=n):(xi=t,t=o)):(xi=t,t=o),t}function Yi(){var e,t,n,i;return e=xi,t=Cs(),t!==r?(n=ns(),n!==r?(i=Cs(),i!==r?(Ti=e,t=et(n),e=t):(xi=e,e=o)):(xi=e,e=o)):(xi=e,e=o),e}function Zi(){var e,t,n,i;return e=xi,t=Cs(),t!==r?(n=rs(),n!==r?(i=Cs(),i!==r?(Ti=e,t=et(n),e=t):(xi=e,e=o)):(xi=e,e=o)):(xi=e,e=o),e}function es(){var t,n,i,s,u,a,f,l;return t=xi,n=Cs(),n!==r?(i=vs(),i!==r?(s=Cs(),s!==r?(u=is(),u!==r?(a=Cs(),a!==r?(f=vs(),f!==r?(l=Cs(),l!==r?(Ti=t,n=tt(i,u,f),t=n):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o),t===r&&(t=xi,n=Cs(),n!==r?(e.charCodeAt(xi)===42?(i=nt,xi++):(i=r,Ai===0&&Fi(rt)),i!==r?(s=Cs(),s!==r?(u=us(),u!==r?(a=Cs(),a!==r?(f=vs(),f!==r?(l=Cs(),l!==r?(Ti=t,n=it(u,f),t=n):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o),t===r&&(t=xi,n=Cs(),n!==r?(i=vs(),i!==r?(s=Cs(),s!==r?(u=os(),u!==r?(a=Cs(),a!==r?(e.charCodeAt(xi)===42?(f=nt,xi++):(f=r,Ai===0&&Fi(rt)),f!==r?(l=Cs(),l!==r?(Ti=t,n=st(i,u),t=n):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o))),t}function ts(){var t,n,i,s,c,h,p,v,m,g,y,b,w,E,S,x;return t=xi,n=Cs(),n!==r?(i=vs(),i!==r?(s=Cs(),s!==r?(c=fs(),c!==r?(h=Cs(),h!==r?(p=vs(),p!==r?(v=Cs(),v!==r?(m=xi,e.charCodeAt(xi)===91?(g=W,xi++):(g=r,Ai===0&&Fi(X)),g!==r?(y=ls(),y!==r?(e.charCodeAt(xi)===93?(b=V,xi++):(b=r,Ai===0&&Fi($)),b!==r?(Ti=m,g=Y(y),m=g):(xi=m,m=o)):(xi=m,m=o)):(xi=m,m=o),m===r&&(m=d),m!==r?(g=Cs(),g!==r?(e.charCodeAt(xi)===123?(y=u,xi++):(y=r,Ai===0&&Fi(a)),y!==r?(b=Cs(),b!==r?(w=Ji(),w===r&&(w=d),w!==r?(E=Cs(),E!==r?(e.charCodeAt(xi)===125?(S=f,xi++):(S=r,Ai===0&&Fi(l)),S!==r?(x=Cs(),x!==r?(Ti=t,n=ot(i,c,p,m,w),t=n):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o),t}function ns(){var t;return e.substr(xi,3)===ut?(t=ut,xi+=3):(t=r,Ai===0&&Fi(at)),t===r&&(e.substr(xi,3)===ft?(t=ft,xi+=3):(t=r,Ai===0&&Fi(lt))),t}function rs(){var t;return e.substr(xi,3)===ct?(t=ct,xi+=3):(t=r,Ai===0&&Fi(ht)),t}function is(){var e,t;return e=xi,t=ss(),t===r&&(t=os(),t===r&&(t=us(),t===r&&(t=as()))),t!==r&&(Ti=e,t=pt(t)),e=t,e}function ss(){var t,n;return Ai++,e.substr(xi,2)===vt?(t=vt,xi+=2):(t=r,Ai===0&&Fi(mt)),t===r&&(e.substr(xi,3)===gt?(t=gt,xi+=3):(t=r,Ai===0&&Fi(yt)),t===r&&(e.substr(xi,2)===bt?(t=bt,xi+=2):(t=r,Ai===0&&Fi(wt)),t===r&&(e.substr(xi,5)===Et?(t=Et,xi+=5):(t=r,Ai===0&&Fi(St)),t===r&&(e.substr(xi,3)===xt?(t=xt,xi+=3):(t=r,Ai===0&&Fi(Tt)),t===r&&(e.substr(xi,2)===Nt?(t=Nt,xi+=2):(t=r,Ai===0&&Fi(Ct)),t===r&&(e.substr(xi,4)===kt?(t=kt,xi+=4):(t=r,Ai===0&&Fi(Lt)),t===r&&(e.substr(xi,2)===At?(t=At,xi+=2):(t=r,Ai===0&&Fi(Ot)),t===r&&(e.substr(xi,3)===Mt?(t=Mt,xi+=3):(t=r,Ai===0&&Fi(_t)))))))))),Ai--,t===r&&(n=r,Ai===0&&Fi(dt)),t}function os(){var t,n;return Ai++,e.substr(xi,2)===Pt?(t=Pt,xi+=2):(t=r,Ai===0&&Fi(Ht)),t===r&&(e.substr(xi,3)===Bt?(t=Bt,xi+=3):(t=r,Ai===0&&Fi(jt)),t===r&&(e.substr(xi,2)===Ft?(t=Ft,xi+=2):(t=r,Ai===0&&Fi(It)),t===r&&(e.substr(xi,2)===qt?(t=qt,xi+=2):(t=r,Ai===0&&Fi(Rt)),t===r&&(e.substr(xi,2)===Ut?(t=Ut,xi+=2):(t=r,Ai===0&&Fi(zt)),t===r&&(e.substr(xi,2).toLowerCase()===Wt?(t=e.substr(xi,2),xi+=2):(t=r,Ai===0&&Fi(Xt))))))),Ai--,t===r&&(n=r,Ai===0&&Fi(Dt)),t}function us(){var t,n;return Ai++,e.substr(xi,2)===$t?(t=$t,xi+=2):(t=r,Ai===0&&Fi(Jt)),t===r&&(e.substr(xi,3)===Kt?(t=Kt,xi+=3):(t=r,Ai===0&&Fi(Qt)),t===r&&(e.substr(xi,2)===Gt?(t=Gt,xi+=2):(t=r,Ai===0&&Fi(Yt)),t===r&&(e.substr(xi,2)===Zt?(t=Zt,xi+=2):(t=r,Ai===0&&Fi(en)),t===r&&(e.substr(xi,2)===tn?(t=tn,xi+=2):(t=r,Ai===0&&Fi(nn)),t===r&&(e.substr(xi,2).toLowerCase()===rn?(t=e.substr(xi,2),xi+=2):(t=r,Ai===0&&Fi(sn))))))),Ai--,t===r&&(n=r,Ai===0&&Fi(Vt)),t}function as(){var t,n;return Ai++,e.substr(xi,4).toLowerCase()===un?(t=e.substr(xi,4),xi+=4):(t=r,Ai===0&&Fi(an)),t===r&&(e.substr(xi,4).toLowerCase()===fn?(t=e.substr(xi,4),xi+=4):(t=r,Ai===0&&Fi(ln)),t===r&&(e.substr(xi,4).toLowerCase()===cn?(t=e.substr(xi,4),xi+=4):(t=r,Ai===0&&Fi(hn)),t===r&&(e.substr(xi,3).toLowerCase()===pn?(t=e.substr(xi,3),xi+=3):(t=r,Ai===0&&Fi(dn))))),Ai--,t===r&&(n=r,Ai===0&&Fi(on)),t}function fs(){var t,n;return Ai++,t=xi,e.substr(xi,3).toLowerCase()===mn?(n=e.substr(xi,3),xi+=3):(n=r,Ai===0&&Fi(gn)),n===r&&(e.substr(xi,4).toLowerCase()===yn?(n=e.substr(xi,4),xi+=4):(n=r,Ai===0&&Fi(bn)),n===r&&(e.substr(xi,3).toLowerCase()===wn?(n=e.substr(xi,3),xi+=3):(n=r,Ai===0&&Fi(En)),n===r&&(e.substr(xi,5).toLowerCase()===Sn?(n=e.substr(xi,5),xi+=5):(n=r,Ai===0&&Fi(xn)),n===r&&(e.substr(xi,3).toLowerCase()===Tn?(n=e.substr(xi,3),xi+=3):(n=r,Ai===0&&Fi(Nn)),n===r&&(e.substr(xi,3).toLowerCase()===Cn?(n=e.substr(xi,3),xi+=3):(n=r,Ai===0&&Fi(kn)),n===r&&(e.substr(xi,6).toLowerCase()===Ln?(n=e.substr(xi,6),xi+=6):(n=r,Ai===0&&Fi(An)),n===r&&(e.substr(xi,3).toLowerCase()===On?(n=e.substr(xi,3),xi+=3):(n=r,Ai===0&&Fi(Mn)),n===r&&(e.substr(xi,8).toLowerCase()===_n?(n=e.substr(xi,8),xi+=8):(n=r,Ai===0&&Fi(Dn)),n===r&&(e.substr(xi,6).toLowerCase()===Pn?(n=e.substr(xi,6),xi+=6):(n=r,Ai===0&&Fi(Hn)),n===r&&(e.substr(xi,8).toLowerCase()===Bn?(n=e.substr(xi,8),xi+=8):(n=r,Ai===0&&Fi(jn)),n===r&&(e.substr(xi,6).toLowerCase()===Fn?(n=e.substr(xi,6),xi+=6):(n=r,Ai===0&&Fi(In)),n===r&&(e.substr(xi,4).toLowerCase()===qn?(n=e.substr(xi,4),xi+=4):(n=r,Ai===0&&Fi(Rn)),n===r&&(e.substr(xi,3).toLowerCase()===Un?(n=e.substr(xi,3),xi+=3):(n=r,Ai===0&&Fi(zn)),n===r&&(e.substr(xi,3).toLowerCase()===Wn?(n=e.substr(xi,3),xi+=3):(n=r,Ai===0&&Fi(Xn)))))))))))))))),n!==r&&(Ti=t,n=pt(n)),t=n,Ai--,t===r&&(n=r,Ai===0&&Fi(vn)),t}function ls(){var t,n,i,s,u,a;t=xi,n=xi,i=[],s=xi,u=cs(),u!==r?(e.charCodeAt(xi)===44?(a=b,xi++):(a=r,Ai===0&&Fi(w)),a!==r?(Ti=s,u=J(u),s=u):(xi=s,s=o)):(xi=s,s=o);while(s!==r)i.push(s),s=xi,u=cs(),u!==r?(e.charCodeAt(xi)===44?(a=b,xi++):(a=r,Ai===0&&Fi(w)),a!==r?(Ti=s,u=J(u),s=u):(xi=s,s=o)):(xi=s,s=o);return i!==r?(s=xi,u=cs(),u!==r&&(Ti=s,u=J(u)),s=u,s!==r?(i=[i,s],n=i):(xi=n,n=o)):(xi=n,n=o),n!==r&&(Ti=t,n=Vn(n)),t=n,t}function cs(){var t,n,i,s,u,a,f,l;return t=xi,n=Cs(),n!==r?(i=hs(),i!==r?(s=Cs(),s!==r?(e.charCodeAt(xi)===61?(u=N,xi++):(u=r,Ai===0&&Fi(C)),u!==r?(a=Cs(),a!==r?(f=vs(),f!==r?(l=Cs(),l!==r?(Ti=t,n=$n(i,f),t=n):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o),t}function hs(){var t,n;return Ai++,e.substr(xi,5).toLowerCase()===Kn?(t=e.substr(xi,5),xi+=5):(t=r,Ai===0&&Fi(Qn)),t===r&&(e.substr(xi,5).toLowerCase()===Gn?(t=e.substr(xi,5),xi+=5):(t=r,Ai===0&&Fi(Yn)),t===r&&(e.substr(xi,2).toLowerCase()===Zn?(t=e.substr(xi,2),xi+=2):(t=r,Ai===0&&Fi(er)),t===r&&(e.substr(xi,3).toLowerCase()===tr?(t=e.substr(xi,3),xi+=3):(t=r,Ai===0&&Fi(nr)),t===r&&(e.substr(xi,9).toLowerCase()===rr?(t=e.substr(xi,9),xi+=9):(t=r,Ai===0&&Fi(ir)),t===r&&(e.substr(xi,10).toLowerCase()===sr?(t=e.substr(xi,10),xi+=10):(t=r,Ai===0&&Fi(or)),t===r&&(e.substr(xi,9).toLowerCase()===ur?(t=e.substr(xi,9),xi+=9):(t=r,Ai===0&&Fi(ar)),t===r&&(e.substr(xi,10).toLowerCase()===fr?(t=e.substr(xi,10),xi+=10):(t=r,Ai===0&&Fi(lr)),t===r&&(e.substr(xi,11).toLowerCase()===cr?(t=e.substr(xi,11),xi+=11):(t=r,Ai===0&&Fi(hr)),t===r&&(e.substr(xi,12).toLowerCase()===pr?(t=e.substr(xi,12),xi+=12):(t=r,Ai===0&&Fi(dr)),t===r&&(e.substr(xi,12).toLowerCase()===vr?(t=e.substr(xi,12),xi+=12):(t=r,Ai===0&&Fi(mr)),t===r&&(e.substr(xi,13).toLowerCase()===gr?(t=e.substr(xi,13),xi+=13):(t=r,Ai===0&&Fi(yr)),t===r&&(e.substr(xi,12).toLowerCase()===br?(t=e.substr(xi,12),xi+=12):(t=r,Ai===0&&Fi(wr)),t===r&&(e.substr(xi,13).toLowerCase()===Er?(t=e.substr(xi,13),xi+=13):(t=r,Ai===0&&Fi(Sr)),t===r&&(e.substr(xi,14).toLowerCase()===xr?(t=e.substr(xi,14),xi+=14):(t=r,Ai===0&&Fi(Tr)),t===r&&(e.substr(xi,15).toLowerCase()===Nr?(t=e.substr(xi,15),xi+=15):(t=r,Ai===0&&Fi(Cr)),t===r&&(e.substr(xi,7).toLowerCase()===kr?(t=e.substr(xi,7),xi+=7):(t=r,Ai===0&&Fi(Lr)))))))))))))))))),Ai--,t===r&&(n=r,Ai===0&&Fi(Jn)),t}function ps(){var t,n,i,s;return t=xi,e.charCodeAt(xi)===34?(n=Ar,xi++):(n=r,Ai===0&&Fi(Or)),n!==r?(i=ds(),i!==r?(e.charCodeAt(xi)===34?(s=Ar,xi++):(s=r,Ai===0&&Fi(Or)),s!==r?(Ti=t,n=Mr(i),t=n):(xi=t,t=o)):(xi=t,t=o)):(xi=t,t=o),t}function ds(){var t,n,i,s;t=[],n=xi,i=xi,Ai++,e.charCodeAt(xi)===34?(s=Ar,xi++):(s=r,Ai===0&&Fi(Or)),Ai--,s===r?i=_r:(xi=i,i=o),i!==r?(e.substr(xi,2)===Dr?(s=Dr,xi+=2):(s=r,Ai===0&&Fi(Pr)),s===r&&(e.length>xi?(s=e.charAt(xi),xi++):(s=r,Ai===0&&Fi(Hr))),s!==r?(Ti=n,i=Br(s),n=i):(xi=n,n=o)):(xi=n,n=o);while(n!==r)t.push(n),n=xi,i=xi,Ai++,e.charCodeAt(xi)===34?(s=Ar,xi++):(s=r,Ai===0&&Fi(Or)),Ai--,s===r?i=_r:(xi=i,i=o),i!==r?(e.substr(xi,2)===Dr?(s=Dr,xi+=2):(s=r,Ai===0&&Fi(Pr)),s===r&&(e.length>xi?(s=e.charAt(xi),xi++):(s=r,Ai===0&&Fi(Hr))),s!==r?(Ti=n,i=Br(s),n=i):(xi=n,n=o)):(xi=n,n=o);return t}function vs(){var t,n,i;Ai++,t=xi,n=[],Fr.test(e.charAt(xi))?(i=e.charAt(xi),xi++):(i=r,Ai===0&&Fi(Ir));if(i!==r)while(i!==r)n.push(i),Fr.test(e.charAt(xi))?(i=e.charAt(xi),xi++):(i=r,Ai===0&&Fi(Ir));else n=o;return n!==r&&(Ti=t,n=qr(n)),t=n,t===r&&(t=ps()),Ai--,t===r&&(n=r,Ai===0&&Fi(jr)),t}function ms(){var t,n;return Ai++,t=xi,Ur.test(e.charAt(xi))?(n=e.charAt(xi),xi++):(n=r,Ai===0&&Fi(zr)),n!==r&&(Ti=t,n=Br(n)),t=n,Ai--,t===r&&(n=r,Ai===0&&Fi(Rr)),t}function gs(){var t,n;return Ai++,t=xi,Xr.test(e.charAt(xi))?(n=e.charAt(xi),xi++):(n=r,Ai===0&&Fi(Vr)),n!==r&&(Ti=t,n=Br(n)),t=n,Ai--,t===r&&(n=r,Ai===0&&Fi(Wr)),t}function ys(){var t;return e.substr(xi,2)===$r?(t=$r,xi+=2):(t=r,Ai===0&&Fi(Jr)),t}function bs(){var t;return e.substr(xi,2)===Kr?(t=Kr,xi+=2):(t=r,Ai===0&&Fi(Qr)),t}function ws(){var t,n,i;return t=xi,n=xi,Ai++,e.substr(xi,2)===Kr?(i=Kr,xi+=2):(i=r,Ai===0&&Fi(Qr)),Ai--,i===r?n=_r:(xi=n,n=o),n!==r?(e.length>xi?(i=e.charAt(xi),xi++):(i=r,Ai===0&&Fi(Hr)),i!==r?(Ti=t,n=Br(i),t=n):(xi=t,t=o)):(xi=t,t=o),t}function Es(){var e,t,n,i;e=xi,t=ys();if(t!==r){n=[],i=ws();while(i!==r)n.push(i),i=ws();n!==r?(i=bs(),i!==r?(Ti=e,t=Gr(t,n,i),e=t):(xi=e,e=o)):(xi=e,e=o)}else xi=e,e=o;return e}function Ss(){var t;return e.substr(xi,2)===Yr?(t=Yr,xi+=2):(t=r,Ai===0&&Fi(Zr)),t===r&&(e.charCodeAt(xi)===35?(t=ei,xi++):(t=r,Ai===0&&Fi(ti))),t}function xs(){var t;return ni.test(e.charAt(xi))?(t=e.charAt(xi),xi++):(t=r,Ai===0&&Fi(ri)),t}function Ts(){var e,t,n,i;e=xi,t=Ss();if(t!==r){n=[],i=xs();while(i!==r)n.push(i),i=xs();n!==r?(Ti=e,t=ii(t,n),e=t):(xi=e,e=o)}else xi=e,e=o;return e}function Ns(){var e,t;return Ai++,e=Ts(),e===r&&(e=Es()),Ai--,e===r&&(t=r,Ai===0&&Fi(si)),e}function Cs(){var e,t;e=[],t=ms(),t===r&&(t=gs(),t===r&&(t=Ns()));while(t!==r)e.push(t),t=ms(),t===r&&(t=gs(),t===r&&(t=Ns()));return e}function ks(){var e;return e=As(),e===r&&(e=Ls()),e}function Ls(){var t,n,i;Ai++,t=xi,n=[],ui.test(e.charAt(xi))?(i=e.charAt(xi),xi++):(i=r,Ai===0&&Fi(ai));if(i!==r)while(i!==r)n.push(i),ui.test(e.charAt(xi))?(i=e.charAt(xi),xi++):(i=r,Ai===0&&Fi(ai));else n=o;return n!==r&&(Ti=t,n=fi(n)),t=n,Ai--,t===r&&(n=r,Ai===0&&Fi(oi)),t}function As(){var t,n,i,s,u,a;Ai++,t=xi,n=xi,i=[],ui.test(e.charAt(xi))?(s=e.charAt(xi),xi++):(s=r,Ai===0&&Fi(ai));if(s!==r)while(s!==r)i.push(s),ui.test(e.charAt(xi))?(s=e.charAt(xi),xi++):(s=r,Ai===0&&Fi(ai));else i=o;if(i!==r){e.charCodeAt(xi)===46?(s=ci,xi++):(s=r,Ai===0&&Fi(hi));if(s!==r){u=[],ui.test(e.charAt(xi))?(a=e.charAt(xi),xi++):(a=r,Ai===0&&Fi(ai));if(a!==r)while(a!==r)u.push(a),ui.test(e.charAt(xi))?(a=e.charAt(xi),xi++):(a=r,Ai===0&&Fi(ai));else u=o;u!==r?(i=[i,s,u],n=i):(xi=n,n=o)}else xi=n,n=o}else xi=n,n=o;return n!==r&&(Ti=t,n=pi(n)),t=n,Ai--,t===r&&(n=r,Ai===0&&Fi(li)),t}function Os(){var t,n;return Ai++,e.substr(xi,4).toLowerCase()===vi?(t=e.substr(xi,4),xi+=4):(t=r,Ai===0&&Fi(mi)),t===r&&(e.substr(xi,5).toLowerCase()===gi?(t=e.substr(xi,5),xi+=5):(t=r,Ai===0&&Fi(yi)),t===r&&(e.substr(xi,2).toLowerCase()===bi?(t=e.substr(xi,2),xi+=2):(t=r,Ai===0&&Fi(wi)),t===r&&(e.substr(xi,3).toLowerCase()===Ei?(t=e.substr(xi,3),xi+=3):(t=r,Ai===0&&Fi(Si))))),Ai--,t===r&&(n=r,Ai===0&&Fi(di)),t}function Ms(e,t){t&&Object.getOwnPropertyNames(t).forEach(function(n){e[n]=t[n]})}function _s(e,t){return e=e?e:{},Ms(e,t),e}function Ds(e){var t={};return e[0].forEach(function(e){t=_s(t,e)}),_s(t,e[1])}function Ps(e){return["true","on","1"].indexOf(e.toLowerCase())>-1?"true":"false"}function Hs(e,t){return t===undefined||t==="*"?!0:e.entities.some(function(e){return e.name===t})}function Bs(e,t){this.message="Entity '"+e+"' in arc ",this.message+="'"+t.from+" "+t.kind+" "+t.to+"' ",this.message+="is not defined.",this.name="EntityNotDefinedError"}function js(e,t){return e||(e={},e.entities=[]),t&&t.arcs&&t.arcs.forEach(function(t){t.forEach(function(t){if(t.from&&!Hs(e,t.from))throw new Bs(t.from,t);if(t.to&&!Hs(e,t.to))throw new Bs(t.to,t)})}),e}function Fs(e){return e&&e.options?e.options.watermark?!0:!1:!1}function Is(e){return e&&e.arcs?e.arcs.some(function(e){return e.some(function(e){return["alt","else","opt","break","par","seq","strict","neg","critical","ignore","consider","assert","loop","ref","exc"].indexOf(e.kind)>-1})}):!1}function qs(e,t){var n=Fs(e),r=Is(t);return{extendedOptions:n,extendedArcTypes:r,extendedFeatures:n||r}}var n=arguments.length>1?arguments[1]:{},r={},i={program:qi},s=qi,o=r,u="{",a={type:"literal",value:"{",description:'"{"'},f="}",l={type:"literal",value:"}",description:'"}"'},c=function(e,t){t[1]=js(t[1],t[2]);var n=_s(t[0],_s(t[1],t[2]));return n=_s({meta:qs(t[0],t[2])},n),e.length>0&&(n=_s({precomment:e},n)),n},h="msc",p={type:"literal",value:"msc",description:'"msc"'},d=null,v=function(e){return{options:e}},m=function(e){return{entities:e}},g=function(e){return{arcs:e}},y=[],b=",",w={type:"literal",value:",",description:'","'},E=function(e){return e},S=";",x={type:"literal",value:";",description:'";"'},T=function(e){return Ds(e)},N="=",C={type:"literal",value:"=",description:'"="'},k=function(e){return e},L=function(e){return e.toString()},A=function(e){return e.toString()},O=function(e,t){var n={};return e=e.toLowerCase(),e==="wordwraparcs"?n[e]=Ps(t):n[e]=t,n},M="hscale",_={type:"literal",value:"hscale",description:'"hscale"'},D="width",P={type:"literal",value:"width",description:'"width"'},H="arcgradient",B={type:"literal",value:"arcgradient",description:'"arcgradient"'},j="wordwraparcs",F={type:"literal",value:"wordwraparcs",description:'"wordwraparcs"'},I="watermark",q={type:"literal",value:"watermark",description:'"watermark"'},R=function(e){return e},U=function(e){return e[0].push(e[1]),e[0]},z={type:"other",description:"entity"},W="[",X={type:"literal",value:"[",description:'"["'},V="]",$={type:"literal",value:"]",description:'"]"'},J=function(e){return e},K=function(e,t){var n={};return n.name=e,_s(n,t)},Q=function(e){return[e]},G=function(e){return e[0].push(e[1][0]),e[0]},Y=function(e){return e},Z=function(e,t){return _s(e,t)},et=function(e){return{kind:e}},tt=function(e,t,n){return{kind:t,from:e,to:n}},nt="*",rt={type:"literal",value:"*",description:'"*"'},it=function(e,t){return{kind:e,from:"*",to:t}},st=function(e,t){return{kind:t,from:e,to:"*"}},ot=function(e,t,n,r,i){var s={kind:t,from:e,to:n,arcs:i};return _s(s,r)},ut="|||",at={type:"literal",value:"|||",description:'"|||"'},ft="...",lt={type:"literal",value:"...",description:'"..."'},ct="---",ht={type:"literal",value:"---",description:'"---"'},pt=function(e){return e.toLowerCase()},dt={type:"other",description:"bi-directional arrow"},vt="--",mt={type:"literal",value:"--",description:'"--"'},gt="<->",yt={type:"literal",value:"<->",description:'"<->"'},bt="==",wt={type:"literal",value:"==",description:'"=="'},Et="<<=>>",St={type:"literal",value:"<<=>>",description:'"<<=>>"'},xt="<=>",Tt={type:"literal",value:"<=>",description:'"<=>"'},Nt="..",Ct={type:"literal",value:"..",description:'".."'},kt="<<>>",Lt={type:"literal",value:"<<>>",description:'"<<>>"'},At="::",Ot={type:"literal",value:"::",description:'"::"'},Mt="<:>",_t={type:"literal",value:"<:>",description:'"<:>"'},Dt={type:"other",description:"left to right arrow"},Pt="->",Ht={type:"literal",value:"->",description:'"->"'},Bt="=>>",jt={type:"literal",value:"=>>",description:'"=>>"'},Ft="=>",It={type:"literal",value:"=>",description:'"=>"'},qt=">>",Rt={type:"literal",value:">>",description:'">>"'},Ut=":>",zt={type:"literal",value:":>",description:'":>"'},Wt="-x",Xt={type:"literal",value:"-x",description:'"-x"'},Vt={type:"other",description:"right to left arrow"},$t="<-",Jt={type:"literal",value:"<-",description:'"<-"'},Kt="<<=",Qt={type:"literal",value:"<<=",description:'"<<="'},Gt="<=",Yt={type:"literal",value:"<=",description:'"<="'},Zt="<<",en={type:"literal",value:"<<",description:'"<<"'},tn="<:",nn={type:"literal",value:"<:",description:'"<:"'},rn="x-",sn={type:"literal",value:"x-",description:'"x-"'},on={type:"other",description:"box"},un="note",an={type:"literal",value:"note",description:'"note"'},fn="abox",ln={type:"literal",value:"abox",description:'"abox"'},cn="rbox",hn={type:"literal",value:"rbox",description:'"rbox"'},pn="box",dn={type:"literal",value:"box",description:'"box"'},vn={type:"other",description:"arc spanning box"},mn="alt",gn={type:"literal",value:"alt",description:'"alt"'},yn="else",bn={type:"literal",value:"else",description:'"else"'},wn="opt",En={type:"literal",value:"opt",description:'"opt"'},Sn="break",xn={type:"literal",value:"break",description:'"break"'},Tn="par",Nn={type:"literal",value:"par",description:'"par"'},Cn="seq",kn={type:"literal",value:"seq",description:'"seq"'},Ln="strict",An={type:"literal",value:"strict",description:'"strict"'},On="neg",Mn={type:"literal",value:"neg",description:'"neg"'},_n="critical",Dn={type:"literal",value:"critical",description:'"critical"'},Pn="ignore",Hn={type:"literal",value:"ignore",description:'"ignore"'},Bn="consider",jn={type:"literal",value:"consider",description:'"consider"'},Fn="assert",In={type:"literal",value:"assert",description:'"assert"'},qn="loop",Rn={type:"literal",value:"loop",description:'"loop"'},Un="ref",zn={type:"literal",value:"ref",description:'"ref"'},Wn="exc",Xn={type:"literal",value:"exc",description:'"exc"'},Vn=function(e){return Ds(e)},$n=function(e,t){var n={};return e=e.toLowerCase(),e=e.replace("colour","color"),n[e]=t,n},Jn={type:"other",description:"attribute name"},Kn="label",Qn={type:"literal",value:"label",description:'"label"'},Gn="idurl",Yn={type:"literal",value:"idurl",description:'"idurl"'},Zn="id",er={type:"literal",value:"id",description:'"id"'},tr="url",nr={type:"literal",value:"url",description:'"url"'},rr="linecolor",ir={type:"literal",value:"linecolor",description:'"linecolor"'},sr="linecolour",or={type:"literal",value:"linecolour",description:'"linecolour"'},ur="textcolor",ar={type:"literal",value:"textcolor",description:'"textcolor"'},fr="textcolour",lr={type:"literal",value:"textcolour",description:'"textcolour"'},cr="textbgcolor",hr={type:"literal",value:"textbgcolor",description:'"textbgcolor"'},pr="textbgcolour",dr={type:"literal",value:"textbgcolour",description:'"textbgcolour"'},vr="arclinecolor",mr={type:"literal",value:"arclinecolor",description:'"arclinecolor"'},gr="arclinecolour",yr={type:"literal",value:"arclinecolour",description:'"arclinecolour"'},br="arctextcolor",wr={type:"literal",value:"arctextcolor",description:'"arctextcolor"'},Er="arctextcolour",Sr={type:"literal",value:"arctextcolour",description:'"arctextcolour"'},xr="arctextbgcolor",Tr={type:"literal",value:"arctextbgcolor",description:'"arctextbgcolor"'},Nr="arctextbgcolour",Cr={type:"literal",value:"arctextbgcolour",description:'"arctextbgcolour"'},kr="arcskip",Lr={type:"literal",value:"arcskip",description:'"arcskip"'},Ar='"',Or={type:"literal",value:'"',description:'"\\""'},Mr=function(e){return e.join("")},_r=void 0,Dr='\\"',Pr={type:"literal",value:'\\"',description:'"\\\\\\""'},Hr={type:"any",description:"any character"},Br=function(e){return e},jr={type:"other",description:"identifier"},Fr=/^[A-Za-z_0-9]/,Ir={type:"class",value:"[A-Za-z_0-9]",description:"[A-Za-z_0-9]"},qr=function(e){return e.join("")},Rr={type:"other",description:"whitespace"},Ur=/^[ \t]/,zr={type:"class",value:"[ \\t]",description:"[ \\t]"},Wr={type:"other",description:"lineend"},Xr=/^[\r\n]/,Vr={type:"class",value:"[\\r\\n]",description:"[\\r\\n]"},$r="/*",Jr={type:"literal",value:"/*",description:'"/*"'},Kr="*/",Qr={type:"literal",value:"*/",description:'"*/"'},Gr=function(e,t,n){return e+t.join("")+n},Yr="//",Zr={type:"literal",value:"//",description:'"//"'},ei="#",ti={type:"literal",value:"#",description:'"#"'},ni=/^[^\r\n]/,ri={type:"class",value:"[^\\r\\n]",description:"[^\\r\\n]"},ii=function(e,t){return e+t.join("")},si={type:"other",description:"comment"},oi={type:"other",description:"integer"},ui=/^[0-9]/,ai={type:"class",value:"[0-9]",description:"[0-9]"},fi=function(e){return parseInt(e.join(""),10)},li={type:"other",description:"real"},ci=".",hi={type:"literal",value:".",description:'"."'},pi=function(e){return parseFloat(e.join(""))},di={type:"other",description:"boolean"},vi="true",mi={type:"literal",value:"true",description:'"true"'},gi="false",yi={type:"literal",value:"false",description:'"false"'},bi="on",wi={type:"literal",value:"on",description:'"on"'},Ei="off",Si={type:"literal",value:"off",description:'"off"'},xi=0,Ti=0,Ni=0,Ci={line:1,column:1,seenCR:!1},ki=0,Li=[],Ai=0,Oi;if("startRule"in n){if(!(n.startRule in i))throw new Error("Can't start parsing from rule \""+n.startRule+'".');s=i[n.startRule]}Oi=s();if(Oi!==r&&xi===e.length)return Oi;throw Oi!==r&&xi<e.length&&Fi({type:"end",description:"end of input"}),Ii(null,Li,ki)}return e(t,Error),{SyntaxError:t,parse:n}}),n("parse/msgennyparser",[],function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,t,n,r,i,s){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=s,this.name="SyntaxError"}function n(e){function Jr(){return e.substring(Rr,qr)}function Kr(){return Rr}function Qr(){return ei(Rr).line}function Gr(){return ei(Rr).column}function Yr(e){throw ni(null,[{type:"other",description:e}],Rr)}function Zr(e){throw ni(e,null,Rr)}function ei(t){function n(t,n,r){var i,s;for(i=n;i<r;i++)s=e.charAt(i),s==="\n"?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):s==="\r"||s==="\u2028"||s==="\u2029"?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return Ur!==t&&(Ur>t&&(Ur=0,zr={line:1,column:1,seenCR:!1}),n(zr,Ur,t),Ur=t),zr}function ti(e){if(qr<Wr)return;qr>Wr&&(Wr=qr,Xr=[]),Xr.push(e)}function ni(n,r,i){function s(e){var t=1;e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});while(t<e.length)e[t-1]===e[t]?e.splice(t,1):t++}function o(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var r=new Array(e.length),i,s,o;for(o=0;o<e.length;o++)r[o]=e[o].description;return i=e.length>1?r.slice(0,-1).join(", ")+" or "+r[e.length-1]:r[0],s=t?'"'+n(t)+'"':"end of input","Expected "+i+" but "+s+" found."}var u=ei(i),a=i<e.length?e.charAt(i):null;return r!==null&&s(r),new t(n!==null?n:o(r,a),r,a,i,u.line,u.column)}function ri(){var e,t,n,i;return e=qr,t=Ui(),t!==r?(n=ii(),n!==r?(i=Ui(),i!==r?(Rr=e,t=u(t,n),e=t):(qr=e,e=o)):(qr=e,e=o)):(qr=e,e=o),e}function ii(){var e,t,n,i,s;return e=qr,t=qr,n=si(),n!==r&&(Rr=t,n=f(n)),t=n,t===r&&(t=a),t!==r?(n=qr,i=ai(),i!==r&&(Rr=n,i=l(i)),n=i,n===r&&(n=a),n!==r?(i=qr,s=li(),s!==r&&(Rr=i,s=c(s)),i=s,i===r&&(i=a),i!==r?(t=[t,n,i],e=t):(qr=e,e=o)):(qr=e,e=o)):(qr=e,e=o),e}function si(){var t,n,i,s,u,a;t=qr,n=qr,i=[],s=qr,u=oi(),u!==r?(e.charCodeAt(qr)===44?(a=p,qr++):(a=r,Vr===0&&ti(d)),a!==r?(Rr=s,u=v(u),s=u):(qr=s,s=o)):(qr=s,s=o);while(s!==r)i.push(s),s=qr,u=oi(),u!==r?(e.charCodeAt(qr)===44?(a=p,qr++):(a=r,Vr===0&&ti(d)),a!==r?(Rr=s,u=v(u),s=u):(qr=s,s=o)):(qr=s,s=o);return i!==r?(s=qr,u=oi(),u!==r?(e.charCodeAt(qr)===59?(a=m,qr++):(a=r,Vr===0&&ti(g)),a!==r?(Rr=s,u=v(u),s=u):(qr=s,s=o)):(qr=s,s=o),s!==r?(i=[i,s],n=i):(qr=n,n=o)):(qr=n,n=o),n!==r&&(Rr=t,n=y(n)),t=n,t}function oi(){var t,n,i,s,u,a,f,l;return t=qr,n=Ui(),n!==r?(i=ui(),i!==r?(s=Ui(),s!==r?(e.charCodeAt(qr)===61?(u=b,qr++):(u=r,Vr===0&&ti(w)),u!==r?(a=Ui(),a!==r?(f=qr,l=ki(),l!==r&&(Rr=f,l=E(l)),f=l,f===r&&(f=qr,l=zi(),l!==r&&(Rr=f,l=S(l)),f=l,f===r&&(f=qr,l=Vi(),l!==r&&(Rr=f,l=x(l)),f=l)),f!==r?(l=Ui(),l!==r?(Rr=t,n=T(i,f),t=n):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o),t}function ui(){var t;return e.substr(qr,6).toLowerCase()===N?(t=e.substr(qr,6),qr+=6):(t=r,Vr===0&&ti(C)),t===r&&(e.substr(qr,5).toLowerCase()===k?(t=e.substr(qr,5),qr+=5):(t=r,Vr===0&&ti(L)),t===r&&(e.substr(qr,11).toLowerCase()===A?(t=e.substr(qr,11),qr+=11):(t=r,Vr===0&&ti(O)),t===r&&(e.substr(qr,12).toLowerCase()===M?(t=e.substr(qr,12),qr+=12):(t=r,Vr===0&&ti(_)),t===r&&(e.substr(qr,9).toLowerCase()===D?(t=e.substr(qr,9),qr+=9):(t=r,Vr===0&&ti(P)))))),t}function ai(){var t,n,i,s,u,a;t=qr,n=qr,i=[],s=qr,u=fi(),u!==r?(e.charCodeAt(qr)===44?(a=p,qr++):(a=r,Vr===0&&ti(d)),a!==r?(Rr=s,u=H(u),s=u):(qr=s,s=o)):(qr=s,s=o);while(s!==r)i.push(s),s=qr,u=fi(),u!==r?(e.charCodeAt(qr)===44?(a=p,qr++):(a=r,Vr===0&&ti(d)),a!==r?(Rr=s,u=H(u),s=u):(qr=s,s=o)):(qr=s,s=o);return i!==r?(s=qr,u=fi(),u!==r?(e.charCodeAt(qr)===59?(a=m,qr++):(a=r,Vr===0&&ti(g)),a!==r?(Rr=s,u=H(u),s=u):(qr=s,s=o)):(qr=s,s=o),s!==r?(i=[i,s],n=i):(qr=n,n=o)):(qr=n,n=o),n!==r&&(Rr=t,n=B(n)),t=n,t}function fi(){var t,n,i,s,u,f,l,c,h;return Vr++,t=qr,n=Ui(),n!==r?(i=Mi(),i!==r?(s=Ui(),s!==r?(u=qr,e.charCodeAt(qr)===58?(f=F,qr++):(f=r,Vr===0&&ti(I)),f!==r?(l=Ui(),l!==r?(c=Ci(),c!==r?(h=Ui(),h!==r?(Rr=u,f=q(c),u=f):(qr=u,u=o)):(qr=u,u=o)):(qr=u,u=o)):(qr=u,u=o),u===r&&(u=a),u!==r?(Rr=t,n=R(i,u),t=n):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o),Vr--,t===r&&(n=r,Vr===0&&ti(j)),t}function li(){var t,n,i,s,u;t=[],n=qr,i=ci(),i!==r?(s=Ui(),s!==r?(e.charCodeAt(qr)===59?(u=m,qr++):(u=r,Vr===0&&ti(g)),u!==r?(Rr=n,i=U(i),n=i):(qr=n,n=o)):(qr=n,n=o)):(qr=n,n=o);if(n!==r)while(n!==r)t.push(n),n=qr,i=ci(),i!==r?(s=Ui(),s!==r?(e.charCodeAt(qr)===59?(u=m,qr++):(u=r,Vr===0&&ti(g)),u!==r?(Rr=n,i=U(i),n=i):(qr=n,n=o)):(qr=n,n=o)):(qr=n,n=o);else t=o;return t}function ci(){var t,n,i,s,u,a;t=qr,n=qr,i=[],s=qr,u=hi(),u!==r?(e.charCodeAt(qr)===44?(a=p,qr++):(a=r,Vr===0&&ti(d)),a!==r?(Rr=s,u=U(u),s=u):(qr=s,s=o)):(qr=s,s=o);while(s!==r)i.push(s),s=qr,u=hi(),u!==r?(e.charCodeAt(qr)===44?(a=p,qr++):(a=r,Vr===0&&ti(d)),a!==r?(Rr=s,u=U(u),s=u):(qr=s,s=o)):(qr=s,s=o);return i!==r?(s=qr,u=hi(),u!==r&&(Rr=s,u=z(u)),s=u,s!==r?(i=[i,s],n=i):(qr=n,n=o)):(qr=n,n=o),n!==r&&(Rr=t,n=W(n)),t=n,t}function hi(){var e;return e=pi(),e===r&&(e=gi()),e}function pi(){var t,n,i,s,u,f,l;return t=qr,n=qr,i=di(),i!==r&&(Rr=n,i=X(i)),n=i,n===r&&(n=qr,i=mi(),i!==r&&(Rr=n,i=V(i)),n=i,n===r&&(n=qr,i=vi(),i!==r&&(Rr=n,i=$(i)),n=i)),n!==r?(i=qr,e.charCodeAt(qr)===58?(s=F,qr++):(s=r,Vr===0&&ti(I)),s!==r?(u=Ui(),u!==r?(f=Ci(),f!==r?(l=Ui(),l!==r?(Rr=i,s=E(f),i=s):(qr=i,i=o)):(qr=i,i=o)):(qr=i,i=o)):(qr=i,i=o),i===r&&(i=a),i!==r?(Rr=t,n=J(n,i),t=n):(qr=t,t=o)):(qr=t,t=o),t}function di(){var e,t,n,i;return e=qr,t=Ui(),t!==r?(n=yi(),n!==r?(i=Ui(),i!==r?(Rr=e,t=K(n),e=t):(qr=e,e=o)):(qr=e,e=o)):(qr=e,e=o),e}function vi(){var e,t,n,i;return e=qr,t=Ui(),t!==r?(n=bi(),n!==r?(i=Ui(),i!==r?(Rr=e,t=K(n),e=t):(qr=e,e=o)):(qr=e,e=o)):(qr=e,e=o),e}function mi(){var t,n,i,s,u,a,f,l;return t=qr,n=Ui(),n!==r?(i=Mi(),i!==r?(s=Ui(),s!==r?(u=wi(),u!==r?(a=Ui(),a!==r?(f=Mi(),f!==r?(l=Ui(),l!==r?(Rr=t,n=Q(i,u,f),t=n):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o),t===r&&(t=qr,n=Ui(),n!==r?(e.charCodeAt(qr)===42?(i=G,qr++):(i=r,Vr===0&&ti(Y)),i!==r?(s=Ui(),s!==r?(u=xi(),u!==r?(a=Ui(),a!==r?(f=Mi(),f!==r?(l=Ui(),l!==r?(Rr=t,n=Z(u,f),t=n):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o),t===r&&(t=qr,n=Ui(),n!==r?(i=Mi(),i!==r?(s=Ui(),s!==r?(u=Si(),u!==r?(a=Ui(),a!==r?(e.charCodeAt(qr)===42?(f=G,qr++):(f=r,Vr===0&&ti(Y)),f!==r?(l=Ui(),l!==r?(Rr=t,n=et(i,u),t=n):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o))),t}function gi(){var t,n,i,s,u,f,l,c,h,p,d,v,m,g,y;return t=qr,n=Ui(),n!==r?(i=Mi(),i!==r?(s=Ui(),s!==r?(u=Ni(),u!==r?(f=Ui(),f!==r?(l=Mi(),l!==r?(c=Ui(),c!==r?(h=qr,e.charCodeAt(qr)===58?(p=F,qr++):(p=r,Vr===0&&ti(I)),p!==r?(d=Ui(),d!==r?(v=Ci(),v!==r?(m=Ui(),m!==r?(Rr=h,p=E(v),h=p):(qr=h,h=o)):(qr=h,h=o)):(qr=h,h=o)):(qr=h,h=o),h===r&&(h=a),h!==r?(e.charCodeAt(qr)===123?(p=tt,qr++):(p=r,Vr===0&&ti(nt)),p!==r?(d=Ui(),d!==r?(v=li(),v===r&&(v=a),v!==r?(m=Ui(),m!==r?(e.charCodeAt(qr)===125?(g=rt,qr++):(g=r,Vr===0&&ti(it)),g!==r?(y=Ui(),y!==r?(Rr=t,n=st(i,u,l,h,v),t=n):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o),t}function yi(){var t;return e.substr(qr,3)===ot?(t=ot,qr+=3):(t=r,Vr===0&&ti(ut)),t===r&&(e.substr(qr,3)===at?(t=at,qr+=3):(t=r,Vr===0&&ti(ft))),t}function bi(){var t;return e.substr(qr,3)===lt?(t=lt,qr+=3):(t=r,Vr===0&&ti(ct)),t}function wi(){var e,t;return e=qr,t=Ei(),t===r&&(t=Si(),t===r&&(t=xi(),t===r&&(t=Ti()))),t!==r&&(Rr=e,t=ht(t)),e=t,e}function Ei(){var t,n;return Vr++,e.substr(qr,2)===dt?(t=dt,qr+=2):(t=r,Vr===0&&ti(vt)),t===r&&(e.substr(qr,3)===mt?(t=mt,qr+=3):(t=r,Vr===0&&ti(gt)),t===r&&(e.substr(qr,2)===yt?(t=yt,qr+=2):(t=r,Vr===0&&ti(bt)),t===r&&(e.substr(qr,5)===wt?(t=wt,qr+=5):(t=r,Vr===0&&ti(Et)),t===r&&(e.substr(qr,3)===St?(t=St,qr+=3):(t=r,Vr===0&&ti(xt)),t===r&&(e.substr(qr,2)===Tt?(t=Tt,qr+=2):(t=r,Vr===0&&ti(Nt)),t===r&&(e.substr(qr,4)===Ct?(t=Ct,qr+=4):(t=r,Vr===0&&ti(kt)),t===r&&(e.substr(qr,2)===Lt?(t=Lt,qr+=2):(t=r,Vr===0&&ti(At)),t===r&&(e.substr(qr,3)===Ot?(t=Ot,qr+=3):(t=r,Vr===0&&ti(Mt)))))))))),Vr--,t===r&&(n=r,Vr===0&&ti(pt)),t}function Si(){var t,n;return Vr++,e.substr(qr,2)===Dt?(t=Dt,qr+=2):(t=r,Vr===0&&ti(Pt)),t===r&&(e.substr(qr,3)===Ht?(t=Ht,qr+=3):(t=r,Vr===0&&ti(Bt)),t===r&&(e.substr(qr,2)===jt?(t=jt,qr+=2):(t=r,Vr===0&&ti(Ft)),t===r&&(e.substr(qr,2)===It?(t=It,qr+=2):(t=r,Vr===0&&ti(qt)),t===r&&(e.substr(qr,2)===Rt?(t=Rt,qr+=2):(t=r,Vr===0&&ti(Ut)),t===r&&(e.substr(qr,2).toLowerCase()===zt?(t=e.substr(qr,2),qr+=2):(t=r,Vr===0&&ti(Wt))))))),Vr--,t===r&&(n=r,Vr===0&&ti(_t)),t}function xi(){var t,n;return Vr++,e.substr(qr,2)===Vt?(t=Vt,qr+=2):(t=r,Vr===0&&ti($t)),t===r&&(e.substr(qr,3)===Jt?(t=Jt,qr+=3):(t=r,Vr===0&&ti(Kt)),t===r&&(e.substr(qr,2)===Qt?(t=Qt,qr+=2):(t=r,Vr===0&&ti(Gt)),t===r&&(e.substr(qr,2)===Yt?(t=Yt,qr+=2):(t=r,Vr===0&&ti(Zt)),t===r&&(e.substr(qr,2)===en?(t=en,qr+=2):(t=r,Vr===0&&ti(tn)),t===r&&(e.substr(qr,2).toLowerCase()===nn?(t=e.substr(qr,2),qr+=2):(t=r,Vr===0&&ti(rn))))))),Vr--,t===r&&(n=r,Vr===0&&ti(Xt)),t}function Ti(){var t,n;return Vr++,e.substr(qr,4).toLowerCase()===on?(t=e.substr(qr,4),qr+=4):(t=r,Vr===0&&ti(un)),t===r&&(e.substr(qr,4).toLowerCase()===an?(t=e.substr(qr,4),qr+=4):(t=r,Vr===0&&ti(fn)),t===r&&(e.substr(qr,4).toLowerCase()===ln?(t=e.substr(qr,4),qr+=4):(t=r,Vr===0&&ti(cn)),t===r&&(e.substr(qr,3).toLowerCase()===hn?(t=e.substr(qr,3),qr+=3):(t=r,Vr===0&&ti(pn))))),Vr--,t===r&&(n=r,Vr===0&&ti(sn)),t}function Ni(){var t,n;return Vr++,t=qr,e.substr(qr,3).toLowerCase()===vn?(n=e.substr(qr,3),qr+=3):(n=r,Vr===0&&ti(mn)),n===r&&(e.substr(qr,4).toLowerCase()===gn?(n=e.substr(qr,4),qr+=4):(n=r,Vr===0&&ti(yn)),n===r&&(e.substr(qr,3).toLowerCase()===bn?(n=e.substr(qr,3),qr+=3):(n=r,Vr===0&&ti(wn)),n===r&&(e.substr(qr,5).toLowerCase()===En?(n=e.substr(qr,5),qr+=5):(n=r,Vr===0&&ti(Sn)),n===r&&(e.substr(qr,3).toLowerCase()===xn?(n=e.substr(qr,3),qr+=3):(n=r,Vr===0&&ti(Tn)),n===r&&(e.substr(qr,3).toLowerCase()===Nn?(n=e.substr(qr,3),qr+=3):(n=r,Vr===0&&ti(Cn)),n===r&&(e.substr(qr,6).toLowerCase()===kn?(n=e.substr(qr,6),qr+=6):(n=r,Vr===0&&ti(Ln)),n===r&&(e.substr(qr,3).toLowerCase()===An?(n=e.substr(qr,3),qr+=3):(n=r,Vr===0&&ti(On)),n===r&&(e.substr(qr,8).toLowerCase()===Mn?(n=e.substr(qr,8),qr+=8):(n=r,Vr===0&&ti(_n)),n===r&&(e.substr(qr,6).toLowerCase()===Dn?(n=e.substr(qr,6),qr+=6):(n=r,Vr===0&&ti(Pn)),n===r&&(e.substr(qr,8).toLowerCase()===Hn?(n=e.substr(qr,8),qr+=8):(n=r,Vr===0&&ti(Bn)),n===r&&(e.substr(qr,6).toLowerCase()===jn?(n=e.substr(qr,6),qr+=6):(n=r,Vr===0&&ti(Fn)),n===r&&(e.substr(qr,4).toLowerCase()===In?(n=e.substr(qr,4),qr+=4):(n=r,Vr===0&&ti(qn)),n===r&&(e.substr(qr,3).toLowerCase()===Rn?(n=e.substr(qr,3),qr+=3):(n=r,Vr===0&&ti(Un)),n===r&&(e.substr(qr,3).toLowerCase()===zn?(n=e.substr(qr,3),qr+=3):(n=r,Vr===0&&ti(Wn)))))))))))))))),n!==r&&(Rr=t,n=ht(n)),t=n,Vr--,t===r&&(n=r,Vr===0&&ti(dn)),t}function Ci(){var e;return e=ki(),e===r&&(e=Ai()),e}function ki(){var t,n,i,s;return t=qr,e.charCodeAt(qr)===34?(n=Xn,qr++):(n=r,Vr===0&&ti(Vn)),n!==r?(i=Li(),i!==r?(e.charCodeAt(qr)===34?(s=Xn,qr++):(s=r,Vr===0&&ti(Vn)),s!==r?(Rr=t,n=$n(i),t=n):(qr=t,t=o)):(qr=t,t=o)):(qr=t,t=o),t}function Li(){var t,n,i,s;t=[],n=qr,i=qr,Vr++,e.charCodeAt(qr)===34?(s=Xn,qr++):(s=r,Vr===0&&ti(Vn)),Vr--,s===r?i=Jn:(qr=i,i=o),i!==r?(e.substr(qr,2)===Kn?(s=Kn,qr+=2):(s=r,Vr===0&&ti(Qn)),s===r&&(e.length>qr?(s=e.charAt(qr),qr++):(s=r,Vr===0&&ti(Gn))),s!==r?(Rr=n,i=Yn(s),n=i):(qr=n,n=o)):(qr=n,n=o);while(n!==r)t.push(n),n=qr,i=qr,Vr++,e.charCodeAt(qr)===34?(s=Xn,qr++):(s=r,Vr===0&&ti(Vn)),Vr--,s===r?i=Jn:(qr=i,i=o),i!==r?(e.substr(qr,2)===Kn?(s=Kn,qr+=2):(s=r,Vr===0&&ti(Qn)),s===r&&(e.length>qr?(s=e.charAt(qr),qr++):(s=r,Vr===0&&ti(Gn))),s!==r?(Rr=n,i=Yn(s),n=i):(qr=n,n=o)):(qr=n,n=o);return t}function Ai(){var e,t;return e=qr,t=Oi(),t!==r&&(Rr=e,t=Zn(t)),e=t,e}function Oi(){var t,n,i,s;t=[],n=qr,i=qr,Vr++,e.charCodeAt(qr)===44?(s=p,qr++):(s=r,Vr===0&&ti(d)),s===r&&(e.charCodeAt(qr)===59?(s=m,qr++):(s=r,Vr===0&&ti(g)),s===r&&(e.charCodeAt(qr)===123?(s=tt,qr++):(s=r,Vr===0&&ti(nt)))),Vr--,s===r?i=Jn:(qr=i,i=o),i!==r?(e.length>qr?(s=e.charAt(qr),qr++):(s=r,Vr===0&&ti(Gn)),s!==r?(Rr=n,i=Yn(s),n=i):(qr=n,n=o)):(qr=n,n=o);while(n!==r)t.push(n),n=qr,i=qr,Vr++,e.charCodeAt(qr)===44?(s=p,qr++):(s=r,Vr===0&&ti(d)),s===r&&(e.charCodeAt(qr)===59?(s=m,qr++):(s=r,Vr===0&&ti(g)),s===r&&(e.charCodeAt(qr)===123?(s=tt,qr++):(s=r,Vr===0&&ti(nt)))),Vr--,s===r?i=Jn:(qr=i,i=o),i!==r?(e.length>qr?(s=e.charAt(qr),qr++):(s=r,Vr===0&&ti(Gn)),s!==r?(Rr=n,i=Yn(s),n=i):(qr=n,n=o)):(qr=n,n=o);return t}function Mi(){var t,n,i;Vr++,t=qr,n=[],tr.test(e.charAt(qr))?(i=e.charAt(qr),qr++):(i=r,Vr===0&&ti(nr));if(i!==r)while(i!==r)n.push(i),tr.test(e.charAt(qr))?(i=e.charAt(qr),qr++):(i=r,Vr===0&&ti(nr));else n=o;return n!==r&&(Rr=t,n=rr(n)),t=n,t===r&&(t=ki()),Vr--,t===r&&(n=r,Vr===0&&ti(er)),t}function _i(){var t,n;return Vr++,t=qr,sr.test(e.charAt(qr))?(n=e.charAt(qr),qr++):(n=r,Vr===0&&ti(or)),n!==r&&(Rr=t,n=Yn(n)),t=n,Vr--,t===r&&(n=r,Vr===0&&ti(ir)),t}function Di(){var t,n;return Vr++,t=qr,ar.test(e.charAt(qr))?(n=e.charAt(qr),qr++):(n=r,Vr===0&&ti(fr)),n!==r&&(Rr=t,n=Yn(n)),t=n,Vr--,t===r&&(n=r,Vr===0&&ti(ur)),t}function Pi(){var t;return e.substr(qr,2)===lr?(t=lr,qr+=2):(t=r,Vr===0&&ti(cr)),t}function Hi(){var t;return e.substr(qr,2)===hr?(t=hr,qr+=2):(t=r,Vr===0&&ti(pr)),t}function Bi(){var t,n,i;return t=qr,n=qr,Vr++,e.substr(qr,2)===hr?(i=hr,qr+=2):(i=r,Vr===0&&ti(pr)),Vr--,i===r?n=Jn:(qr=n,n=o),n!==r?(e.length>qr?(i=e.charAt(qr),qr++):(i=r,Vr===0&&ti(Gn)),i!==r?(Rr=t,n=Yn(i),t=n):(qr=t,t=o)):(qr=t,t=o),t}function ji(){var e,t,n,i;e=qr,t=Pi();if(t!==r){n=[],i=Bi();while(i!==r)n.push(i),i=Bi();n!==r?(i=Hi(),i!==r?(Rr=e,t=dr(t,n,i),e=t):(qr=e,e=o)):(qr=e,e=o)}else qr=e,e=o;return e}function Fi(){var t;return e.substr(qr,2)===vr?(t=vr,qr+=2):(t=r,Vr===0&&ti(mr)),t===r&&(e.charCodeAt(qr)===35?(t=gr,qr++):(t=r,Vr===0&&ti(yr))),t}function Ii(){var t;return br.test(e.charAt(qr))?(t=e.charAt(qr),qr++):(t=r,Vr===0&&ti(wr)),t}function qi(){var e,t,n,i;e=qr,t=Fi();if(t!==r){n=[],i=Ii();while(i!==r)n.push(i),i=Ii();n!==r?(Rr=e,t=Er(t,n),e=t):(qr=e,e=o)}else qr=e,e=o;return e}function Ri(){var e,t;return Vr++,e=qi(),e===r&&(e=ji()),Vr--,e===r&&(t=r,Vr===0&&ti(Sr)),e}function Ui(){var e,t;e=[],t=_i(),t===r&&(t=Di(),t===r&&(t=Ri()));while(t!==r)e.push(t),t=_i(),t===r&&(t=Di(),t===r&&(t=Ri()));return e}function zi(){var e;return e=Xi(),e===r&&(e=Wi()),e}function Wi(){var t,n,i;Vr++,t=qr,n=[],Tr.test(e.charAt(qr))?(i=e.charAt(qr),qr++):(i=r,Vr===0&&ti(Nr));if(i!==r)while(i!==r)n.push(i),Tr.test(e.charAt(qr))?(i=e.charAt(qr),qr++):(i=r,Vr===0&&ti(Nr));else n=o;return n!==r&&(Rr=t,n=Cr(n)),t=n,Vr--,t===r&&(n=r,Vr===0&&ti(xr)),t}function Xi(){var t,n,i,s,u,a;Vr++,t=qr,n=qr,i=[],Tr.test(e.charAt(qr))?(s=e.charAt(qr),qr++):(s=r,Vr===0&&ti(Nr));if(s!==r)while(s!==r)i.push(s),Tr.test(e.charAt(qr))?(s=e.charAt(qr),qr++):(s=r,Vr===0&&ti(Nr));else i=o;if(i!==r){e.charCodeAt(qr)===46?(s=Lr,qr++):(s=r,Vr===0&&ti(Ar));if(s!==r){u=[],Tr.test(e.charAt(qr))?(a=e.charAt(qr),qr++):(a=r,Vr===0&&ti(Nr));if(a!==r)while(a!==r)u.push(a),Tr.test(e.charAt(qr))?(a=e.charAt(qr),qr++):(a=r,Vr===0&&ti(Nr));else u=o;u!==r?(i=[i,s,u],n=i):(qr=n,n=o)}else qr=n,n=o}else qr=n,n=o;return n!==r&&(Rr=t,n=Or(n)),t=n,Vr--,t===r&&(n=r,Vr===0&&ti(kr)),t}function Vi(){var t,n;return Vr++,e.substr(qr,4).toLowerCase()===_r?(t=e.substr(qr,4),qr+=4):(t=r,Vr===0&&ti(Dr)),t===r&&(e.substr(qr,5).toLowerCase()===Pr?(t=e.substr(qr,5),qr+=5):(t=r,Vr===0&&ti(Hr)),t===r&&(e.substr(qr,2).toLowerCase()===Br?(t=e.substr(qr,2),qr+=2):(t=r,Vr===0&&ti(jr)),t===r&&(e.substr(qr,3).toLowerCase()===Fr?(t=e.substr(qr,3),qr+=3):(t=r,Vr===0&&ti(Ir))))),Vr--,t===r&&(n=r,Vr===0&&ti(Mr)),t}function $i(e,t){t&&Object.getOwnPropertyNames(t).forEach(function(n){e[n]=t[n]})}function Ji(e,t){return e=e?e:{},$i(e,t),e}function Ki(e){var t={};return e[0].forEach(function(e){t=Ji(t,e)}),Ji(t,e[1])}function Qi(e){return["true","on","1"].indexOf(e.toLowerCase())>-1?"true":"false"}function Gi(e,t,n){return t===undefined||t==="*"?!0:e.entities.some(function(e){return e.name===t})?!0:n[t]===!0}function Yi(e){var t={};return t.name=e,t}function Zi(e,t,n){return e||(e={},e.entities=[]),n||(n={}),t&&t.arcs&&t.arcs.forEach(function(t){t.forEach(function(t){Gi(e,t.from,n)||(e.entities[e.entities.length]=Yi(t.from)),t.arcs&&(n[t.to]=!0,Ji(e,Zi(e,t,n)),delete n[t.to]),Gi(e,t.to,n)||(e.entities[e.entities.length]=Yi(t.to))})}),e}function es(e){return e&&e.options?e.options.watermark?!0:!1:!1}function ts(e){return e&&e.arcs?e.arcs.some(function(e){return e.some(function(e){return["alt","else","opt","break","par","seq","strict","neg","critical","ignore","consider","assert","loop","ref","exc"].indexOf(e.kind)>-1})}):!1}function ns(e,t){var n=es(e),r=ts(t);return{extendedOptions:n,extendedArcTypes:r,extendedFeatures:n||r}}var n=arguments.length>1?arguments[1]:{},r={},i={program:ri},s=ri,o=r,u=function(e,t){t[1]=Zi(t[1],t[2]);var n=Ji(t[0],Ji(t[1],t[2]));return n=Ji({meta:ns(t[0],t[2])},n),e.length>0&&(n=Ji({precomment:e},n)),n},a=null,f=function(e){return{options:e}},l=function(e){return{entities:e}},c=function(e){return{arcs:e}},h=[],p=",",d={type:"literal",value:",",description:'","'},v=function(e){return e},m=";",g={type:"literal",value:";",description:'";"'},y=function(e){return Ki(e)},b="=",w={type:"literal",value:"=",description:'"="'},E=function(e){return e},S=function(e){return e.toString()},x=function(e){return e.toString()},T=function(e,t){var n={};return e=e.toLowerCase(),e==="wordwraparcs"?n[e]=Qi(t):n[e]=t,n},N="hscale",C={type:"literal",value:"hscale",description:'"hscale"'},k="width",L={type:"literal",value:"width",description:'"width"'},A="arcgradient",O={type:"literal",value:"arcgradient",description:'"arcgradient"'},M="wordwraparcs",_={type:"literal",value:"wordwraparcs",description:'"wordwraparcs"'},D="watermark",P={type:"literal",value:"watermark",description:'"watermark"'},H=function(e){return e},B=function(e){return e[0].push(e[1]),e[0]},j={type:"other",description:"entity"},F=":",I={type:"literal",value:":",description:'":"'},q=function(e){return e},R=function(e,t){var n={};return n.name=e,t&&(n.label=t),n},U=function(e){return e},z=function(e){return[e]},W=function(e){return e[0].push(e[1][0]),e[0]},X=function(e){return e},V=function(e){return e},$=function(e){return e},J=function(e,t){return t&&(e.label=t),e},K=function(e){return{kind:e}},Q=function(e,t,n){return{kind:t,from:e,to:n}},G="*",Y={type:"literal",value:"*",description:'"*"'},Z=function(e,t){return{kind:e,from:"*",to:t}},et=function(e,t){return{kind:t,from:e,to:"*"}},tt="{",nt={type:"literal",value:"{",description:'"{"'},rt="}",it={type:"literal",value:"}",description:'"}"'},st=function(e,t,n,r,i){var s={kind:t,from:e,to:n,arcs:i};return r&&(s.label=r),s},ot="|||",ut={type:"literal",value:"|||",description:'"|||"'},at="...",ft={type:"literal",value:"...",description:'"..."'},lt="---",ct={type:"literal",value:"---",description:'"---"'},ht=function(e){return e.toLowerCase()},pt={type:"other",description:"bi-directional arrow"},dt="--",vt={type:"literal",value:"--",description:'"--"'},mt="<->",gt={type:"literal",value:"<->",description:'"<->"'},yt="==",bt={type:"literal",value:"==",description:'"=="'},wt="<<=>>",Et={type:"literal",value:"<<=>>",description:'"<<=>>"'},St="<=>",xt={type:"literal",value:"<=>",description:'"<=>"'},Tt="..",Nt={type:"literal",value:"..",description:'".."'},Ct="<<>>",kt={type:"literal",value:"<<>>",description:'"<<>>"'},Lt="::",At={type:"literal",value:"::",description:'"::"'},Ot="<:>",Mt={type:"literal",value:"<:>",description:'"<:>"'},_t={type:"other",description:"left to right arrow"},Dt="->",Pt={type:"literal",value:"->",description:'"->"'},Ht="=>>",Bt={type:"literal",value:"=>>",description:'"=>>"'},jt="=>",Ft={type:"literal",value:"=>",description:'"=>"'},It=">>",qt={type:"literal",value:">>",description:'">>"'},Rt=":>",Ut={type:"literal",value:":>",description:'":>"'},zt="-x",Wt={type:"literal",value:"-x",description:'"-x"'},Xt={type:"other",description:"right to left arrow"},Vt="<-",$t={type:"literal",value:"<-",description:'"<-"'},Jt="<<=",Kt={type:"literal",value:"<<=",description:'"<<="'},Qt="<=",Gt={type:"literal",value:"<=",description:'"<="'},Yt="<<",Zt={type:"literal",value:"<<",description:'"<<"'},en="<:",tn={type:"literal",value:"<:",description:'"<:"'},nn="x-",rn={type:"literal",value:"x-",description:'"x-"'},sn={type:"other",description:"box"},on="note",un={type:"literal",value:"note",description:'"note"'},an="abox",fn={type:"literal",value:"abox",description:'"abox"'},ln="rbox",cn={type:"literal",value:"rbox",description:'"rbox"'},hn="box",pn={type:"literal",value:"box",description:'"box"'},dn={type:"other",description:"arc spanning box"},vn="alt",mn={type:"literal",value:"alt",description:'"alt"'},gn="else",yn={type:"literal",value:"else",description:'"else"'},bn="opt",wn={type:"literal",value:"opt",description:'"opt"'},En="break",Sn={type:"literal",value:"break",description:'"break"'},xn="par",Tn={type:"literal",value:"par",description:'"par"'},Nn="seq",Cn={type:"literal",value:"seq",description:'"seq"'},kn="strict",Ln={type:"literal",value:"strict",description:'"strict"'},An="neg",On={type:"literal",value:"neg",description:'"neg"'},Mn="critical",_n={type:"literal",value:"critical",description:'"critical"'},Dn="ignore",Pn={type:"literal",value:"ignore",description:'"ignore"'},Hn="consider",Bn={type:"literal",value:"consider",description:'"consider"'},jn="assert",Fn={type:"literal",value:"assert",description:'"assert"'},In="loop",qn={type:"literal",value:"loop",description:'"loop"'},Rn="ref",Un={type:"literal",value:"ref",description:'"ref"'},zn="exc",Wn={type:"literal",value:"exc",description:'"exc"'},Xn='"',Vn={type:"literal",value:'"',description:'"\\""'},$n=function(e){return e.join("")},Jn=void 0,Kn='\\"',Qn={type:"literal",value:'\\"',description:'"\\\\\\""'},Gn={type:"any",description:"any character"},Yn=function(e){return e},Zn=function(e){return e.join("").trim()},er={type:"other",description:"identifier"},tr=/^[A-Za-z_0-9]/,nr={type:"class",value:"[A-Za-z_0-9]",description:"[A-Za-z_0-9]"},rr=function(e){return e.join("")},ir={type:"other",description:"whitespace"},sr=/^[ \t]/,or={type:"class",value:"[ \\t]",description:"[ \\t]"},ur={type:"other",description:"lineend"},ar=/^[\r\n]/,fr={type:"class",value:"[\\r\\n]",description:"[\\r\\n]"},lr="/*",cr={type:"literal",value:"/*",description:'"/*"'},hr="*/",pr={type:"literal",value:"*/",description:'"*/"'},dr=function(e,t,n){return e+t.join("")+n},vr="//",mr={type:"literal",value:"//",description:'"//"'},gr="#",yr={type:"literal",value:"#",description:'"#"'},br=/^[^\r\n]/,wr={type:"class",value:"[^\\r\\n]",description:"[^\\r\\n]"},Er=function(e,t){return e+t.join("")},Sr={type:"other",description:"comment"},xr={type:"other",description:"integer"},Tr=/^[0-9]/,Nr={type:"class",value:"[0-9]",description:"[0-9]"},Cr=function(e){return parseInt(e.join(""),10)},kr={type:"other",description:"real"},Lr=".",Ar={type:"literal",value:".",description:'"."'},Or=function(e){return parseFloat(e.join(""))},Mr={type:"other",description:"boolean"},_r="true",Dr={type:"literal",value:"true",description:'"true"'},Pr="false",Hr={type:"literal",value:"false",description:'"false"'},Br="on",jr={type:"literal",value:"on",description:'"on"'},Fr="off",Ir={type:"literal",value:"off",description:'"off"'},qr=0,Rr=0,Ur=0,zr={line:1,column:1,seenCR:!1},Wr=0,Xr=[],Vr=0,$r;if("startRule"in n){if(!(n.startRule in i))throw new Error("Can't start parsing from rule \""+n.startRule+'".');s=i[n.startRule]}$r=s();if($r!==r&&qr===e.length)return $r;throw $r!==r&&qr<e.length&&ti({type:"end",description:"end of input"}),ni(null,Xr,Wr)}return e(t,Error),{SyntaxError:t,parse:n}}),n("render/graphics/constants",[],function(){"use strict";return{SVGNS:"http://www.w3.org/2000/svg",XLINKNS:"http://www.w3.org/1999/xlink",LINE_WIDTH:2}}),n("render/graphics/svgelementfactory",["./constants"],function(e){"use strict";function r(e){return t.createTextNode(e)}function i(n,r){var i=t.createElementNS(e.SVGNS,"path");return i.setAttribute("d",n),r&&i.setAttribute("class",r),i}function s(n,r){var i=t.createElementNS(e.SVGNS,"polygon");return i.setAttribute("points",n),r&&i.setAttribute("class",r),i}function o(n,r,i,s){var o=t.createElementNS(e.SVGNS,"rect");return o.setAttribute("width",n.width),o.setAttribute("height",n.height),n.x&&o.setAttribute("x",n.x),n.y&&o.setAttribute("y",n.y),i&&o.setAttribute("rx",i),s&&o.setAttribute("ry",s),r&&o.setAttribute("class",r),o}function u(e,t){var n=3,r="M"+e.x+","+e.y;return r+="l"+n+", -"+e.height/2,r+="l"+(e.width-2*n)+",0",r+="l"+n+","+e.height/2,r+="l-"+n+","+e.height/2,r+="l-"+(e.width-2*n)+",0 ",r+="l-"+n+",-"+e.height/2,i(r,t)}function a(e,t,n){var r=n?n:9,s=r.toString(10),o="M"+e.x+","+e.y;return o+="l"+(e.width-r)+",0 ",o+="l0,"+s+" l"+s+",0 m-"+s+",-"+s+" l"+s+","+s+" ",o+="l0,"+(e.height-r)+" ",o+="l-"+e.width+",0 ",o+="l0,-"+e.height+" ",i(o,t)}function f(e,t,n){var r=n?n:7,s="M"+e.x+","+e.y;return s+=" l"+e.width+",0 ",s+=" l0,"+(e.height-r),s+=" l-"+r.toString(10)+","+r.toString(10),s+=" l-"+(e.width-r)+",0 ",i(s,t)}function l(n,r){var i=t.createElementNS(e.SVGNS,"a");return i.setAttributeNS(e.XLINKNS,"xlink:href",n),i.setAttributeNS(e.XLINKNS,"xlink:title",n),i.setAttributeNS(e.XLINKNS,"xlink:show","new"),i.appendChild(r),i}function c(n,r){var i=t.createElementNS(e.SVGNS,"tspan"),s=t.createTextNode(n);return i.appendChild(s),r?l(r,i):i}function h(r,i,s,o,u,a,f){var l=t.createElementNS(e.SVGNS,"text");l.setAttribute("x",i.toString()),l.setAttribute("y",s.toString()),o&&l.setAttribute("class",o),l.appendChild(c(r,u));if(a){var h=c(" ["+a+"]",f);h.setAttribute("style",n),l.appendChild(h)}return l}function p(e,t){var n=h(e,t.width/2,t.height/2,"watermark"),r=0-Math.atan(t.height/t.width)*360/(2*Math.PI);return n.setAttribute("transform","rotate("+r.toString()+" "+(t.width/2).toString()+" "+(t.height/2).toString()+")"),n}function d(n,r){var i=t.createElementNS(e.SVGNS,"line");return i.setAttribute("x1",n.xFrom.toString()),i.setAttribute("y1",n.yFrom.toString()),i.setAttribute("x2",n.xTo.toString()),i.setAttribute("y2",n.yTo.toString()),r&&i.setAttribute("class",r),i}function v(e){var t=-1;return e.xTo>e.xFrom&&(t=1),{dx:t,dy:t*(e.yTo-e.yFrom)/(e.xTo-e.xFrom)}}function m(e,t){var n=2,r="M"+e.xFrom.toString()+","+e.yFrom.toString(),s=v(e),o=(e.xTo-e.xFrom).toString(),u=(e.yTo-e.yFrom).toString(),a="l"+s.dx.toString()+","+s.dy.toString(),f=" l"+o+","+u;return r+=a,r+="M"+e.xFrom.toString()+","+(e.yFrom-n).toString(),r+=f,r+="M"+e.xFrom.toString()+","+(e.yFrom+n).toString(),r+=f,r+="M"+(e.xTo-s.dx).toString()+","+e.yTo.toString(),r+=a,i(r,t)}function g(e,t,n){return n?m(e,t):d(e,t)}function y(e,t,n,r){var s="M"+e.x.toString()+", -"+e.y.toString();return s+=" l"+n.toString()+",0",s+=" l0,"+t.toString(),s+=" l-"+n.toString()+",0",i(s,r)}function b(n){var r=t.createElementNS(e.SVGNS,"g");return n&&r.setAttribute("id",n),r}function w(n,r,i){var s=t.createElementNS(e.SVGNS,"use");return s.setAttribute("x",n.toString()),s.setAttribute("y",r.toString()),s.setAttributeNS(e.XLINKNS,"xlink:href","#"+i),s}function E(n,r,i){var s=t.createElementNS(e.SVGNS,"marker");return s.setAttribute("orient",i),s.setAttribute("id",n),s.setAttribute("class",r),s.setAttribute("viewBox","0 0 10 10"),s.setAttribute("refX","9"),s.setAttribute("refY","3"),s.setAttribute("markerUnits","strokeWidth"),s.setAttribute("markerWidth","10"),s.setAttribute("markerHeight","10"),s.setAttribute("refX","9"),s.setAttribute("refX","9"),s}function S(e,t){var n=E(e,"arrow-marker","auto"),r=i(t,"arrow-style");return n.appendChild(r),n}function x(e,t){var n=E(e,"arrow-marker","auto"),r=s(t,"filled arrow-style");return n.appendChild(r),n}var t,n="vertical-align : text-top;";return n+="font-size: 0.7em; text-anchor: start;",{init:function(e){t=e},createTextNode:r,createRect:o,createABox:u,createNote:a,createEdgeRemark:f,createText:h,createDiagonalText:p,createLine:g,createUTurn:y,createGroup:b,createUse:w,createMarkerPath:S,createMarkerPolygon:x}}),n("render/graphics/idmanager",[],function(){"use strict";var e="mscgen_js-svg-",t=e;return{setPrefix:function(n){t=e+n},get:function(e){return e?t+e:t}}}),n("render/graphics/svgutensils",["./constants","./idmanager"],function(e,t){"use strict";function i(t){var r=n.createElementNS(e.SVGNS,"svg");return r.setAttribute("version","1.1"),r.setAttribute("xmlns",e.SVGNS),r.setAttribute("xmlns:xlink",e.XLINKNS),r.setAttribute("id",t),r.setAttribute("width",0),r.setAttribute("height",0),n.body.appendChild(r),r}function s(e){var t=n.getElementById(r);t=t?t:i(r),t.appendChild(e);var s=e.getBBox();return t.removeChild(e),s}function o(e){var t=1e5;return Math.abs(e.height)>t||Math.abs(e.width)>t?{height:0,width:0,x:0,y:0}:e}function u(e){return typeof e.getBBox=="function"?o(s(e)):{height:15,width:15,x:2,y:2}}function a(t){var r=n.createElementNS(e.SVGNS,"tspan");return r.appendChild(n.createTextNode(t)),r}function f(t){var r=n.createElementNS(e.SVGNS,"text");return r.setAttribute("x","0"),r.setAttribute("y","0"),r.appendChild(a(t)),r}function l(){return u(f("ÁjyÎ9ƒ@")).height}function c(e){t.setPrefix(e);var r=n.getElementById(t.get());if(r&&r!==undefined){var i=n.getElementById(e);i?i.removeChild(r):n.body.removeChild(r)}}var n,r=t.get("bboxer");return{init:function(e){n=e},removeRenderedSVGFromElement:c,getBBox:u,calculateTextHeight:l}}),n("render/graphics/renderutensils",[],function(){"use strict";function e(e,t){t.scale=e/t.width,t.width*=t.scale,t.height*=t.scale,t.horizontaltransform*=t.scale,t.verticaltransform*=t.scale,t.x=0-t.horizontaltransform,t.y=0-t.verticaltransform}function t(e,t){return e?2*(e+1)*2*t:0}function n(e){return e&&e.indexOf("\\n")===-1?e+"\\n":e}function r(e,t){t.textcolor&&e.setAttribute("style","fill:"+t.textcolor+";")}function i(e,t){var n="";t.textbgcolor&&(n+="fill:"+t.textbgcolor+";"),t.linecolor&&(n+="stroke:"+t.linecolor+";"),e.setAttribute("style",n)}function s(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function o(e){s(e,"from","to")}return{scaleCanvasToWidth:e,determineDepthCorrection:t,oneLineLabelsFix:n,colorText:r,colorBox:i,swapfromto:o}}),n("render/graphics/renderskeleton",["./svgelementfactory","./constants"],function(e,t){"use strict";function r(t,n,r){t.appendChild(e.createMarkerPath(n,r))}function i(t,n,r){t.appendChild(e.createMarkerPolygon(n,r))}function s(e,t){return r(e,t+"signal","M 9 3 l -8 2"),r(e,t+"signal-u","M 9 3 l -8 -2"),r(e,t+"signal-l","M 9 3 l 8 2"),r(e,t+"signal-lu","M 9 3 l 8 -2"),i(e,t+"method","1,1 9,3 1,5"),i(e,t+"method-l","17,1 9,3 17,5"),r(e,t+"callback","M 1 1 l 8 2 l -8 2"),r(e,t+"callback-l","M 17 1 l -8 2 l 8 2"),r(e,t+"lost","M6.5,-0.5 L11.5,5.5 M6.5,5.5 L11.5,-0.5"),e}function o(e){var t=n.createElement("style");return t.setAttribute("type","text/css"),t.appendChild(n.createTextNode(p(e))),t}function u(e){var r=n.createElementNS(t.SVGNS,"svg");return r.setAttribute("version","1.1"),r.setAttribute("id",e),r.setAttribute("xmlns",t.SVGNS),r.setAttribute("xmlns:xlink",t.XLINKNS),r}function a(r){var i=n.createElementNS(t.SVGNS,"defs");return i.appendChild(o(r)),i=s(i,r),i.appendChild(e.createGroup(r+"__defs")),i}function f(e){var r=n.createElementNS(t.SVGNS,"desc");return r.setAttribute("id",e+"__msc_source"),r}function l(t){var n=e.createGroup(t+"__body");return n.appendChild(e.createGroup(t+"__background")),n.appendChild(e.createGroup(t+"__arcspanlayer")),n.appendChild(e.createGroup(t+"__lifelinelayer")),n.appendChild(e.createGroup(t+"__sequencelayer")),n.appendChild(e.createGroup(t+"__notelayer")),n.appendChild(e.createGroup(t+"__watermark")),n}function c(t){return e.init(t.document),t.document}function h(e,t,r){n=c(r);var i=n.getElementById(e);i===null&&(i=n.body);var s=u(t);return s.appendChild(f(t)),s.appendChild(a(t)),s.appendChild(l(t)),i.appendChild(s),n}function p(e){return"svg{  font-family:Helvetica,sans-serif;  font-size:9pt;  font-weight:normal;  font-style:normal;  text-decoration:none;  background-color:white;  stroke:black;  color:black;}rect{  fill:none;  stroke:black;  stroke-width:"+t.LINE_WIDTH+";}.bglayer{  fill:white;  stroke:white;  stroke-width:0;}rect.textbg{  fill:white;  stroke:white;  stroke-width:0;  opacity:0.9;}line{  stroke:black;  stroke-width:"+t.LINE_WIDTH+";}.arcrowomit{  stroke-dasharray:2,2;}text{  color:inherit;  stroke:none;  text-anchor:middle;}text.entity{  text-decoration:underline;}text.anchor-start{  text-anchor:start;}path{  stroke:black;  color:black;  stroke-width:2;  fill:none;}.dotted{  stroke-dasharray:5,2;}.striped{  stroke-dasharray:10,5;}.arrow-marker{  overflow:visible;}.arrow-style{  stroke:black;  stroke-dasharray:100,1; /* 'none' should work, but doesn't in webkit */  stroke-width:1;}.filled{  stroke:inherit;  fill:black; /* no-inherit */}.arcrowomit{  stroke-dasharray:2,2;}.box{  /* fill: #ffc;  no-inherit */  fill:white;  opacity:0.9;}.boxtext, .arctext{  font-size:0.8em;  text-anchor:middle;}.comment{  stroke-dasharray:5,2;} ."+e+"signal{  marker-end:url(#"+e+"signal);} ."+e+"signal-u{  marker-end:url(#"+e+"signal-u);} ."+e+"signal-both{  marker-end:url(#"+e+"signal);  marker-start:url(#"+e+"signal-l);} ."+e+"signal-both-u{  marker-end:url(#"+e+"signal-u);  marker-start:url(#"+e+"signal-lu);} ."+e+"signal-both-self{  marker-end:url(#"+e+"signal-u);  marker-start:url(#"+e+"signal-l);} ."+e+"method{  marker-end:url(#"+e+"method);} ."+e+"method-both{  marker-end:url(#"+e+"method);  marker-start:url(#"+e+"method-l);} ."+e+"returnvalue{  stroke-dasharray:5,2;  marker-end:url(#"+e+"callback);} ."+e+"returnvalue-both{  stroke-dasharray:5,2;  marker-end:url(#"+e+"callback);  marker-start:url(#"+e+"callback-l);}."+e+"dotted{  stroke-dasharray:5,2;} ."+e+"callback{  marker-end:url(#"+e+"callback);} ."+e+"callback-both{  marker-end:url(#"+e+"callback);  marker-start:url(#"+e+"callback-l);} ."+e+"emphasised{  marker-end:url(#"+e+"method);} ."+e+"emphasised-both{  marker-end:url(#"+e+"method);  marker-start:url(#"+e+"method-l);} ."+e+"lost{  marker-end:url(#"+e+"lost);} .inherit{  stroke:inherit;  color:inherit;} .inherit-fill{  fill:inherit;}.watermark{  stroke:black;  color:black;  fill:black;  font-size: 48pt;  font-weight:bold;  opacity:0.14;}"}var n;return{bootstrap:h,init:c}}),n("render/text/dotmap",[],function(){"use strict";function s(e,t,n){var r="";return e&&i[e]&&(r=i[e],t&&n&&t>=n&&(r==="signal"&&(r="signal-u"),r==="signal-both"&&(t===n?r="signal-both-self":r="signal-both-u"))),r}var e={"->":"rvee","<->":"rvee","=>":"normal","<=>":"normal","-x":"oinvonormal"},t={box:"box",abox:"hexagon",rbox:"box",note:"note"},n={">>":"dashed","<<>>":"dashed","..":"dashed",":>":"bold","<:>":"bold","::":"bold",rbox:"rounded"},r={"|||":"emptyarc","...":"emptyarc","---":"emptyarc","->":"directional","=>":"directional","=>>":"directional",">>":"directional",":>":"directional","-x":"directional",note:"box",box:"box",abox:"box",rbox:"box","<->":"bidirectional","<=>":"bidirectional","<<=>>":"bidirectional","<<>>":"bidirectional","<:>":"bidirectional","--":"nondirectional","==":"nondirectional","..":"nondirectional","::":"nondirectional",alt:"inline_expression","else":"inline_expression",opt:"inline_expression","break":"inline_expression",par:"inline_expression",seq:"inline_expression",strict:"inline_expression",neg:"inline_expression",critical:"inline_expression",ignore:"inline_expression",consider:"inline_expression",assert:"inline_expression",loop:"inline_expression",ref:"inline_expression",exc:"inline_expression"},i={"->":"signal","<->":"signal-both","=>":"method","<=>":"method-both",">>":"returnvalue","<<>>":"returnvalue-both","..":"dotted","=>>":"callback","<<=>>":"callback-both",":>":"emphasised","<:>":"emphasised-both","::":"double","-x":"lost"};return{getArrow:function(t){return e[t]},getShape:function(e){return t[e]},getStyle:function(e){return n[e]},getAggregate:function(e){return r[e]},determineArcClass:s}}),n("render/text/textutensils",["./dotmap"],function(e){"use strict";function t(e,t){var n=0,r=[],i=0,s=0,o=0,u=0,a=e.replace(/[\t\n]+/g," ").replace(/\\n/g,"\n");while(u<=a.length)u>=a.length?r.push(a.substring(i,u)):a[u]==="\n"?(n=0,o=u,r.push(a.substring(i,o)),i=o+1):n++>=t&&(o=a.substring(0,u).lastIndexOf(" "),o===-1||o<i?(n=1,o=u,s=u):(n=0,s=o+1),r.push(a.substring(i,o)),i=s),u++;return r}function n(e){var t=Math.abs(e),n=t/8;return t>160&&t<=320?n=t/6.4:t>320&&t<=480?n=t/5.9:t>480&&(n=t/5.6),n}function r(r,i,s,o){return"box"===e.getAggregate(i)||undefined===i||o?t(r,n(s)):r.split("\\n")}return{wrap:t,determineMaxTextWidth:n,splitLabel:r,unescapeString:function(e){return e.replace(/\\\"/g,'"')},escapeString:function(e){return e.replace(/\\\"/g,'"').replace(/\"/g,'\\"')},formatNumber:function(e,t){var n=e.toString(),r=t-n.length;for(var i=0;i<r;i++)n=" "+n;return n},sanitizeBooleanesque:function(e){return["1","true","y","yes","on"].indexOf(e)>-1}}}),n("render/text/asttransform",[],function(){"use strict";function e(e,t){e&&t&&e.forEach(function(e){t.forEach(function(t){t(e)})})}function t(e,t,n,r){r&&r.forEach(function(r){r(n,e,t)})}function n(e,n,i){n.forEach(function(s){t(e,n,s,i),s.arcs&&r(e,s.arcs,i)})}function r(e,t,r){e&&t&&r&&t.forEach(function(t){n(e,t,r)})}function i(t,n,i){return e(t.entities,n),r(t.entities,t.arcs,i),t}return{transform:i}}),n("render/text/utensils",[],function(){"use strict";return{deepCopy:function(t){return JSON.parse(JSON.stringify(t))}}}),n("render/text/flatten",["./asttransform","./dotmap","./utensils"],function(e,t,n){"use strict";function i(e){e.label===undefined&&(e.label=e.name)}function s(e){var t={"<-":"->","<=":"=>","<<=":"=>>","<<":">>","<:":":>","x-":"-x"};if(e.kind&&t[e.kind]){e.kind=t[e.kind];var n=e.from;e.from=e.to,e.to=n}return e}function o(e,t){!e.linecolor&&t.arclinecolor&&(e.linecolor=t.arclinecolor),!e.textcolor&&t.arctextcolor&&(e.textcolor=t.arctextcolor),!e.textbgcolor&&t.arctextbgcolor&&(e.textbgcolor=t.arctextbgcolor)}function u(e,t){if(e&&e.from){var n=t.filter(function(t){return t.name===e.from});n.length>0&&o(e,n[0])}}function a(e){var t=e.arcs.length;return e.arcs.forEach(function(e){e[0].arcs&&(t+=a(e[0])+1)}),t}function f(e,i,s,u,l){var c={};"inline_expression"===t.getAggregate(e[0].kind)?(c=n.deepCopy(e[0]),c.arcs?(c.numberofrows=a(c),delete c.arcs,i.arcs.push([c]),e[0].arcs.forEach(function(e){f(e,i,c.from,c.to,l+1),e.forEach(function(e){o(e,c)})}),l>r&&(r=l)):i.arcs.push([c]),i.arcs.push([{kind:"|||",from:c.from,to:c.to}]),c.depth=l):(s&&u&&e.forEach(function(e){"emptyarc"===t.getAggregate(e.kind)&&(e.from=s,e.to=u,e.depth=l)}),i.arcs.push(e))}function l(e){var t={};return r=0,t.options=e.options?n.deepCopy(e.options):undefined,t.entities=e.entities?n.deepCopy(e.entities):undefined,t.arcs=[],e&&e.arcs&&e.arcs.forEach(function(e){f(e,t,undefined,undefined,0)}),t.depth=r+1,t}function c(e,t){var r=[];return e.forEach(function(e){t.from!==e.name&&(t.to=e.name,r.push(n.deepCopy(t)))}),r}function h(e){if(e.entities&&e.arcs){var t=[],r={};e.arcs.forEach(function(i,s){i.forEach(function(o,u){o.to==="*"&&(r=n.deepCopy(o),delete e.arcs[s][u],t=c(e.entities,r),i[u]=t.shift(),e.arcs[s]=i.concat(t))})})}return e}var r=0;return{swapRTLArc:s,unwind:l,explodeBroadcasts:h,flatten:function(t){return e.transform(l(t),[i],[s,u])},dotFlatten:function(t){return h(e.transform(t,[i],[s,u]))}}}),n("render/graphics/rowmemory",[],function(){"use strict";function r(r,i){e=[],t=r,n=i}function i(r){return e[r]?e[r]:{y:t+1.5*n+r*n,height:n}}function s(){return i(e.length-1)}function o(t,r,s){if(r===undefined||r<n)r=n;if(s===undefined){var o=i(t-1);o&&o.y>0&&(s=o.y+(o.height+r)/2)}e[t]={y:s,height:r}}var e=[],t=0,n=0;return{clear:r,get:i,getLast:s,set:o}}),n("render/graphics/entities",[],function(){"use strict";function s(s){r.interEntitySpacing=e,r.height=n,r.width=t,s&&s.hscale&&(r.interEntitySpacing=s.hscale*e,r.width=s.hscale*t),i={}}function o(e,t){return{from:u(e),to:u(t)}}function u(e){return i[e]}function a(e,t){i[e.name]=t+r.width/2}function f(){return r}function l(e){r.height=e}var e=160,t=100,n=34,r={interEntitySpacing:e,height:n,width:t},i={};return{init:s,getX:u,setX:a,getOAndD:o,setHeight:l,getDims:f}}),n("render/graphics/renderast",["./svgelementfactory","./svgutensils","./renderutensils","./renderskeleton","../text/textutensils","../text/flatten","../text/dotmap","./rowmemory","./idmanager","./entities","./constants"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";function m(e,t,n,r){var i=s.flatten(e);g(i,t,n,r),y(i),b(i)}function g(e,n,i,s){a.setPrefix(i),d.document=r.bootstrap(i,a.get(),s),t.init(d.document),w(d,e.depth),x(d,e.options),T(d,n)}function y(e){D(e.entities),u.clear(f.getDims().height,d.arcRowHeight),H(e.arcs,e.entities)}function b(e){var t=N(e);C(d,t),L(e.options,t),A(t)}function w(e,n){E(e.layer,e.document),e.textHeight=t.calculateTextHeight(),e.maxDepth=n?n:0}function E(e,t){e.defs=t.getElementById(a.get("__defs")),e.lifeline=t.getElementById(a.get("__lifelinelayer")),e.sequence=t.getElementById(a.get("__sequencelayer")),e.notes=t.getElementById(a.get("__notelayer")),e.inline=t.getElementById(a.get("__arcspanlayer")),e.watermark=t.getElementById(a.get("__watermark"))}function S(e,t){e.arcRowHeight=h,e.arcGradient=p,e.wordWrapArcs=!1,t&&(t.arcgradient&&(e.arcRowHeight=parseInt(t.arcgradient,10)+h,e.arcGradient=parseInt(t.arcgradient,10)+p),t.wordwraparcs&&t.wordwraparcs==="true"&&(e.wordWrapArcs=!0))}function x(e,t){f.init(t),S(e,t)}function T(t,n){if(n){var r=e.createTextNode("\n\n# Generated by mscgen_js - http://sverweij.github.io/mscgen_js\n"+n);t.document.getElementById(a.get("__msc_source")).appendChild(r)}}function N(e){var t=n.determineDepthCorrection(e.depth,l.LINE_WIDTH),r=u.getLast(),i={width:e.entities.length*f.getDims().interEntitySpacing+t,height:r.y+r.height/2+2*c,horizontaltransform:(f.getDims().interEntitySpacing+t-f.getDims().width)/2,verticaltransform:c,scale:1};return i.x=0-i.horizontaltransform,i.y=0-i.verticaltransform,i}function C(t,n){var r=e.createRect(n,"bglayer");t.document.getElementById(a.get("__background")).appendChild(r)}function k(t,n){d.layer.watermark.appendChild(e.createDiagonalText(t,n))}function L(e,t){e&&(e.watermark&&k(e.watermark,t),e.width&&n.scaleCanvasToWidth(e.width,t))}function A(e){var t=d.document.getElementById(a.get()),n=d.document.getElementById(a.get("__body"));n.setAttribute("transform","translate("+e.horizontaltransform+","+e.verticaltransform+")"+" scale("+e.scale+","+e.scale+")"),t.setAttribute("width",e.width.toString()),t.setAttribute("height",e.height.toString())}function O(e){var n=f.getDims().height,r=0;return e.forEach(function(e){r=t.getBBox(M(e,f.getDims())).height,r>n&&(n=r)}),n}function M(t,r){var i=e.createGroup(a.get(t.name)),s=V(a.get(t.name)+"_txt",t,0,r.height/2,r.width,"entity"),o=e.createRect(r);return n.colorBox(o,t),i.appendChild(o),i.appendChild(s),i}function _(t,n){d.layer.defs.appendChild(M(t,f.getDims())),d.layer.sequence.appendChild(e.createUse(n,0,a.get(t.name)))}function D(e){var t=0;e&&(f.setHeight(O(e)+l.LINE_WIDTH*2),e.forEach(function(e){_(e,t),f.setX(e,t),t+=f.getDims().interEntitySpacing})),d.arcEndX=t-f.getDims().interEntitySpacing+f.getDims().width}function P(n,r,i){var s=!1,c=[];u.set(r),n.forEach(function(e,n){var h=a.get(r.toString()+"_"+n.toString()),p,m="";e.label&&(m=e.label);switch(o.getAggregate(e.kind)){case"emptyarc":p=R(e,h),s="..."===e.kind,c.push({id:h,layer:d.layer.sequence});break;case"box":p=K(h,f.getOAndD(e.from,e.to),e),c.push({id:h,layer:d.layer.notes});break;case"inline_expression":p=B(h+"_label",e),c.push({id:h+"_label",layer:d.layer.notes}),v.push({id:h,arc:e,rownum:r});break;default:if(e.from&&e.to){var g=e.from,y=e.to,b=0,w=0;y==="*"?(w=f.getX(g),i.forEach(function(t,n){t.name!==g&&(b=f.getX(t.name),e.label="",d.layer.defs.appendChild(W(h+"bc"+n,e,w,b)),c.push({id:h+"bc"+n,layer:d.layer.sequence}))}),e.label=m,p=V(h+"_txt",e,0,0-d.textHeight/2-l.LINE_WIDTH,d.arcEndX),c.push({id:h+"_txt",layer:d.layer.sequence})):(p=W(h,e,f.getX(g),f.getX(y)),c.push({id:h,layer:d.layer.sequence}))}}p&&(u.set(r,Math.max(u.get(r).height,t.getBBox(p).height+2*l.LINE_WIDTH)),d.layer.defs.appendChild(p))});var h="arcrow_"+r.toString(),p="arcrow";s&&(p="arcrowomit"),d.layer.defs.appendChild(I(i,p,u.get(r).height,a.get(h))),d.layer.lifeline.appendChild(e.createUse(0,u.get(r).y,a.get(h))),c.forEach(function(t){t.layer.appendChild(e.createUse(0,u.get(r).y,t.id))})}function H(t,n){v=[],d.layer.defs.appendChild(I(n,a.get("arcrow"))),d.layer.lifeline.appendChild(e.createUse(0,u.get(-1).y,a.get("arcrow")));if(t){for(var r=0;r<t.length;r++)P(t[r],r,n);j(v)}}function B(r,i){var s={from:f.getX(i.from),to:f.getX(i.to)},o=7;s.from>s.to&&n.swapfromto(s);var u=s.to-s.from+(f.getDims().interEntitySpacing-2*l.LINE_WIDTH)-o-l.LINE_WIDTH,a=s.from-(f.getDims().interEntitySpacing-3*l.LINE_WIDTH)/2-(d.maxDepth-i.depth)*2*l.LINE_WIDTH,c=e.createGroup(r);i.label=i.kind+(i.label?": "+i.label:"");var h=V(r+"_txt",i,a+l.LINE_WIDTH-u/2,d.arcRowHeight/4,u,"anchor-start"),p=t.getBBox(h),v=Math.max(p.height+2*l.LINE_WIDTH,d.arcRowHeight/2-2*l.LINE_WIDTH),m=Math.min(p.width+2*l.LINE_WIDTH,u),g=e.createEdgeRemark({width:m-l.LINE_WIDTH+o,height:v,x:a,y:0},"box",o);return n.colorBox(g,i),c.appendChild(g),c.appendChild(h),c}function j(t){t.forEach(function(t){d.layer.defs.appendChild(F(t)),d.layer.inline.appendChild(e.createUse(0,u.get(t.rownum).y,t.id))})}function F(e){var t=u.get(e.rownum).y,n=u.get(e.rownum+e.arc.numberofrows+1).y,r=n-t;return e.arc.label="",K(e.id,f.getOAndD(e.arc.from,e.arc.to),e.arc,r)}function I(t,n,r,i){i||(i=n);if(!r||r<d.arcRowHeight)r=d.arcRowHeight;var s=e.createGroup(i);return t.forEach(function(t){var i=e.createLine({xFrom:f.getX(t.name),yFrom:0-r/2,xTo:f.getX(t.name),yTo:r/2},n);t.linecolor&&i.setAttribute("style","stroke : "+t.linecolor+";"),s.appendChild(i)}),s}function q(t,n,r,i,s){var o=2*(d.arcRowHeight/5),u=f.getDims().interEntitySpacing/3,a=e.createGroup();if(i){var l=e.createUTurn({x:n,y:(o-4)/2},r-2+o,u-4,"none"),c=e.createUTurn({x:n,y:(o+4)/2},r+6+o,u,t);s&&(l.setAttribute("style","stroke: "+s+";"),c.setAttribute("style","stroke: "+s+";")),a.appendChild(l),a.appendChild(c)}else{var h=e.createUTurn({x:n,y:o/2},r+o,u,t);s&&h.setAttribute("style","stroke: "+s+";"),a.appendChild(h)}return a}function R(e,t){var r;e.from&&e.to&&f.getX(e.from)>f.getX(e.to)&&n.swapfromto(e);switch(e.kind){case"...":case"|||":r=$(t,e);break;case"---":r=J(t,e)}return r}function U(e,t,n){return"-x"===e.kind?t+(n-t)*.75:n}function z(e){return e.arcskip?e.arcskip*d.arcRowHeight:0}function W(t,r,i,s){var u=e.createGroup(t),l=a.get(o.determineArcClass(r.kind,i,s)),c=":>"===r.kind||"::"===r.kind||"<:>"===r.kind,h=z(r),p=h===0?d.arcGradient:h;s=U(r,i,s),r.label=n.oneLineLabelsFix(r.label);if(i===s)u.appendChild(q(l,i,h,c,r.linecolor)),u.appendChild(V(t+"_txt",r,i+2-f.getDims().interEntitySpacing/2,0-d.arcRowHeight/5,f.getDims().interEntitySpacing,"anchor-start"));else{var v=e.createLine({xFrom:i,yFrom:0,xTo:s,yTo:p},l,c);r.linecolor&&v.setAttribute("style","stroke:"+r.linecolor+"; fill: "+r.linecolor+";"),u.appendChild(v),u.appendChild(V(t+"_txt",r,i,0,s-i))}return u}function X(r,i,s,o,u,a,f){var l=r,c={};f===0?c=e.createText(i,s,o+d.textHeight/4+f*d.textHeight,u,a.url,a.id,a.idurl):c=e.createText(i,s,o+d.textHeight/4+f*d.textHeight,u,a.url);var h=t.getBBox(c),p=e.createRect(h,"textbg");return n.colorText(c,a),a.textbgcolor&&p.setAttribute("style","fill: "+a.textbgcolor+"; stroke:"+a.textbgcolor+";"),a.url&&!a.textcolor&&(a.textcolor="blue",n.colorText(c,a)),l.appendChild(p),l.appendChild(c),l}function V(t,n,r,s,o,u){var a=e.createGroup(t);if(n.label){var f=r+o/2;n.label=i.unescapeString(n.label),n.id&&(n.id=i.unescapeString(n.id));var l=i.splitLabel(n.label,n.kind,o,d.wordWrapArcs),c=s-(l.length-1)*d.textHeight/2-(l.length-1)/2;l.forEach(function(e,t){a=X(a,e,f,c,u,n,t),c++})}return a}function $(t,n){var r=0,i=d.arcEndX,s=e.createGroup(t);return n.from&&n.to&&(r=f.getX(n.from),i=Math.abs(f.getX(n.to)-f.getX(n.from))),s.appendChild(V(t+"_lbl",n,r,0,i)),s}function J(t,n){var r=0,i=d.arcEndX,s="dotted",o=e.createGroup(t);if(n.from&&n.to){var u=(d.maxDepth-n.depth)*2*l.LINE_WIDTH;r=f.getX(n.from)-(f.getDims().interEntitySpacing+2*l.LINE_WIDTH)/2-u,i=f.getX(n.to)+(f.getDims().interEntitySpacing+2*l.LINE_WIDTH)/2+u,s="striped"}var a=e.createLine({xFrom:r,yFrom:0,xTo:i,yTo:0},s);return o.appendChild(a),o.appendChild($(t+"_txt",n)),n.linecolor&&a.setAttribute("style","stroke: "+n.linecolor+";"),o}function K(r,i,s,o){i.from>i.to&&n.swapfromto(i);var u=i.to-i.from+f.getDims().interEntitySpacing-2*l.LINE_WIDTH,a=9,c=6,h=i.from-(f.getDims().interEntitySpacing-2*l.LINE_WIDTH)/2,p=e.createGroup(r),v,m=V(r+"_txt",s,h,0,u),g=t.getBBox(m),y=o?o:Math.max(g.height+2*l.LINE_WIDTH,d.arcRowHeight-2*l.LINE_WIDTH),b={width:u,height:y,x:h,y:0-y/2};switch(s.kind){case"box":v=e.createRect(b,"box");break;case"rbox":v=e.createRect(b,"box",c,c);break;case"abox":b.y=0,v=e.createABox(b,"box");break;case"note":v=e.createNote(b,"box",a);break;default:var w=(d.maxDepth-s.depth)*2*l.LINE_WIDTH;v=e.createRect({width:u+w*2,height:y,x:h-w,y:0},"box")}return n.colorBox(v,s),p.appendChild(v),p.appendChild(m),p}function Q(e,n){d.document=r.init(n),t.init(d.document),t.removeRenderedSVGFromElement(e)}var c=3,h=38,p=0,d={arcRowHeight:h,arcGradient:p,arcEndX:0,wordWrapArcs:!1,maxDepth:0,textHeight:12,document:{},layer:{defs:{},lifeline:{},sequence:{},notes:{},inline:{}}},v=[];return{clean:Q,renderAST:m}}),n("render/text/ast2dot",["./flatten","./textutensils","./dotmap","./utensils"],function(e,t,n,r){"use strict";function o(e){var t="/* Sequence chart represented as a directed graph\n * in the graphviz dot language (http://graphviz.org/)\n *\n * Generated by mscgen_js (https://sverweij.github.io/mscgen_js)\n */\n\ngraph {\n";return t+=i+"rankdir=LR\n",t+=i+"splines=true\n",t+=i+"ordering=out\n",t+=i+'fontname="Helvetica"\n',t+=i+'fontsize="9"\n',t+=i+'node [style=filled, fillcolor=white fontname="Helvetica", fontsize="9" ]\n',t+=i+'edge [fontname="Helvetica", fontsize="9", arrowhead=vee, arrowtail=vee, dir=forward]\n',t+="\n",e&&(e.entities&&(t+=p(e.entities)+"\n"),e.arcs&&(s=0,t+=b(e.arcs,""))),t+="}"}function u(e){var n=t.wrap(e.replace(/\"/g,'\\"'),40),r=n.slice(0,-1).reduce(function(e,t){return e+t+"\n"},"");return r+=n.slice(-1),r}function a(e,t,n){t&&e.push(n+'="'+u(t)+'"')}function f(e){var t=[];return["label","color","fontcolor","fillcolor"].forEach(function(n){a(t,e[n],n)}),t}function l(e){var t="";return e.length>0&&(t=e.slice(0,-1).reduce(function(e,t){return e+t+", "}," ["),t+=e.slice(-1)+"]"),t}function c(e){return'"'+e+'"'}function h(e){var t="";return t+=c(e.name),t+=l(f(e)),t}function p(e){return e.reduce(function(e,t){return e+i+h(t)+";\n"},"")}function d(e,t){e.label?e.label="("+t+") "+e.label:e.label="("+t+")"}function v(e,t,r){var s="",o="box"+t.toString();s+=o;var u=f(e);return a(u,n.getStyle(e.kind),"style"),a(u,n.getShape(e.kind),"shape"),s+=l(u)+"\n"+i+r,u=[],a(u,"dotted","style"),a(u,"none","dir"),s+=o+" -- {"+c(e.from)+","+c(e.to)+"}",s+=l(u),s}function m(e,t,r){var i="";d(e,r);var s=f(e);a(s,n.getStyle(e.kind),"style");switch(t){case"directional":a(s,n.getArrow(e.kind),"arrowhead");break;case"bidirectional":a(s,n.getArrow(e.kind),"arrowhead"),a(s,n.getArrow(e.kind),"arrowtail"),a(s,"both","dir");break;case"nondirectional":a(s,"none","dir")}return e.arcs||(i+=c(e.from)+" ",i+="--",i+=" "+c(e.to),i+=l(s)),i}function g(e,t,r){var i="",s=n.getAggregate(e.kind);return s==="box"?i+=v(e,t,r):i+=m(e,s,t),i}function y(e,t){var n="";return e.from&&e.kind&&e.to&&(n+=i+t+g(e,++s,t)+"\n",e.arcs&&(n+=i+t+"subgraph cluster_"+s.toString()+"{",e.label&&(n+="\n"+i+t+' label="'+e.kind+": "+e.label+'" labeljust="l" \n'),n+=b(e.arcs,t+i),n+=i+t+"}\n")),n}function b(e,t){var n="";return e.forEach(function(e){e.forEach(function(e){n+=y(e,t)})}),n}var i="  ",s=0;return{render:function(t){return o(e.dotFlatten(r.deepCopy(t)))}}}),n("render/text/ast2thing",["./textutensils"],function(e){"use strict";function o(e){Object.getOwnPropertyNames(e).forEach(function(t){s[t]=e[t]})}function u(e){o(i),o(e)}function a(e,t){return u(t),f(e)}function f(e){var t="";return e&&(e.precomment&&(t+=s.renderCommentfn(e.precomment)),t+=s.program.opener,e.options&&(t+=v(e.options)),e.entities&&(t+=g(e.entities,s.renderEntityfn)),e.arcs&&(t+=S(e.arcs,"")),t+=s.program.closer),t}function l(e,t,n){t&&n&&e.push({name:t,value:n})}function c(e,t){var n=[];return t.forEach(function(t){l(n,t,e[t])}),n}function h(e){return e.reduce(function(e,t){return e+t},"")}function p(e){function t(e){var t=e.match(/[a-z0-9]+/gi);return t&&t!==null?t.length!==1:!0}return t(e)?'"'+e+'"':e}function d(t){return t.name+'="'+e.escapeString(t.value)+'"'}function v(e){var t=c(e,s.supportedOptions),n=t.pop(),r=t.reduce(function(e,t){return e+s.renderOptionfn(t)+s.option.separator},s.option.opener);return r+=s.renderOptionfn(n)+s.option.closer,r}function m(e){var t=s.renderEntityNamefn(e.name);return t+=y(e,s.supportedEntityAttributes),t}function g(e){var t="";return e.length>0&&(t=e.slice(0,-1).reduce(function(e,t){return e+m(t)+s.entity.separator},s.entity.opener),t+=m(e[e.length-1])+s.entity.closer),t}function y(e,t){var n="",r=c(e,t);if(r.length>0){var i=r.pop();n=r.reduce(function(e,t){return e+s.renderAttributefn(t)+s.attribute.separator},s.attribute.opener),n+=s.renderAttributefn(i)+s.attribute.closer}return n}function b(e){return e}function w(e,n){var r="";return e.from&&(r+=s.renderEntityNamefn(e.from)+" "),e.kind&&(r+=s.renderKindfn(e.kind)),e.to&&(r+=" "+s.renderEntityNamefn(e.to)),r+=y(e,s.supportedArcAttributes),e.arcs&&(r+=s.inline.opener,r+=S(e.arcs,n+t),r+=n+s.inline.closer),null===e.arcs&&(r+=s.inline.opener,r+=n+s.inline.closer),r}function E(e,t){var n="";return e.length>0&&(n=e.slice(0,-1).reduce(function(e,n){return e+t+w(n,t)+s.arcline.separator},s.arcline.opener),n+=t+w(e[e.length-1],t)+s.arcline.closer),n}function S(e,t){return e.reduce(function(e,n){return e+E(n,t)},"")}var t="  ",n=" ",r="\n",i={renderCommentfn:h,renderOptionfn:d,renderEntityNamefn:p,renderKindfn:b,supportedOptions:["hscale","width","arcgradient","wordwraparcs","watermark"],supportedEntityAttributes:["label"],supportedArcAttributes:["label"],program:{opener:"",closer:""},option:{opener:"",separator:","+r,closer:";"+r+r},entity:{opener:"",separator:","+n,closer:";"+r+r},arcline:{opener:"",separator:","+r,closer:";"+r},inline:{opener:" {"+r,closer:"}"},attribute:{opener:"",separator:"",closer:""}},s={};return{render:a}}),n("render/text/ast2mscgen",["./dotmap","./textutensils","./ast2thing"],function(e,t,n){"use strict";function u(e){!0===e?(o=!0,r="",i="",s=""):(o=!1,r="  ",i=" ",s="\n")}function a(t){return"inline_expression"===e.getAggregate(t)?"--":t}function f(e){var n="";return e.name&&e.value&&(n+=e.name+'="'+t.escapeString(e.value)+'"'),n}var r="  ",i=" ",s="\n",o=!1;return{render:function(e,t){return u(t),n.render(e,{renderAttributefn:f,renderKindfn:a,supportedOptions:["hscale","width","arcgradient","wordwraparcs"],supportedEntityAttributes:["label","idurl","id","url","linecolor","textcolor","textbgcolor","arclinecolor","arctextcolor","arctextbgcolor","arcskip"],supportedArcAttributes:["label","idurl","id","url","linecolor","textcolor","textbgcolor","arclinecolor","arctextcolor","arctextbgcolor","arcskip"],program:{opener:"msc"+i+"{"+s,closer:"}"},option:{opener:r,separator:","+s,closer:";"+s+s},entity:{opener:r,separator:","+s+r,closer:";"+s+s},attribute:{opener:i+"[",separator:","+i,closer:"]"},arcline:{opener:r,separator:","+s,closer:";"+s},inline:{opener:";"+s,closer:"#"}})}}}),n("utl/paramslikker",[],function(){"use strict";return{getParams:function(e){var t={};if(e){var n;e.slice(1).split("&").forEach(function(e){n=e.split("="),2===n.length&&(t[n[0]]=decodeURIComponent(n[1]))})}return t}}}),n("ui-control/controller-exporter",["../render/text/ast2dot","../render/text/ast2mscgen","../utl/paramslikker"],function(e,t,n){"use strict";function o(e,t,n){return i.replace(/{{config}}/g,n?s:"").replace(/{{language}}/g,t).replace(/{{source}}/g,e)}function u(e){var t=n.getParams(e.search),r="";return t.donottrack&&(r+="&donottrack="+t.donottrack),t.debug&&(r+="&debug="+t.debug),r}function a(e,t,n){return e.pathname+"?lang="+n+u(e)+"&msc="+encodeURIComponent(t)}function f(e,t,n){return a(e,t,n).length<r}var r=4094,i="<!DOCTYPE html>\n<html>\n  <head>\n    <meta content='text/html;charset=utf-8' http-equiv='Content-Type'>\n{{config}}    <script src='https://sverweij.github.io/mscgen_js/mscgen-inpage.js' defer>\n    </script>\n  </head>\n  <body>\n    <pre class='code {{language}} mscgen_js' data-language='{{language}}'>\n{{source}}\n    </pre>\n  </body>\n</html>",s="    <script>\n      var mscgen_js_config = {\n        clickable: true\n      }\n    </script>\n";return{toVectorURI:function(e,t){t=t?t:window;var n=t.btoa(unescape(encodeURIComponent(e)));return"data:image/svg+xml;charset=utf-8;base64,"+n},toHTMLSnippet:o,toHTMLSnippetURI:function(e,t,n){return"data:text/plain;charset=utf-8,"+encodeURIComponent(o(e,t,n))},todotURI:function(t){return"data:text/plain;charset=utf-8,"+encodeURIComponent(e.render(t))},toVanillaMscGenURI:function(e){return"data:text/plain;charset=utf-8,"+encodeURIComponent(t.render(e))},toLocationString:function(e,t,n){var r="# source too long for an URL";return f(e,t,n)&&(r=t),a(e,r,n)}}}),n("ui-control/embed-config",[],function(){"use strict";function t(e,t){Object.getOwnPropertyNames(t).forEach(function(n){e[n]=t[n]})}var e={defaultLanguage:"mscgen",parentElementPrefix:"mscgen_js-parent_",clickable:!1,clickURL:"https://sverweij.github.io/mscgen_js/"};return{getConfig:function(){return"undefined"!=typeof mscgen_js_config&&mscgen_js_config&&"object"==typeof mscgen_js_config&&t(e,mscgen_js_config),e}}}),t(["parse/xuparser","parse/msgennyparser","render/graphics/renderast","render/text/textutensils","ui-control/controller-exporter","ui-control/embed-config"],function(e,t,n,r,i,s){"use strict";function o(){var e=document.getElementsByClassName("mscgen_js");f(e,0),f(document.getElementsByTagName("mscgen"),e.length)}function u(e,t){return r.formatNumber(t,3)+" "+e}function a(e,t){return e.split("").reduce(function(e,n,r){return r===t?e+"<span style='text-decoration:underline'>"+n+"</span>":e+n},"")}function f(e,t){for(var n=0;n<e.length;n++)l(e[n],t+n)}function l(e,t){if(!e.hasAttribute("data-renderedby")){var n=p(e),r=d(e.textContent,n);h(e,t),e.setAttribute("data-renderedby","mscgen_js"),r.entities?v(r,e.id,e.textContent,n):e.innerHTML=e.textContent.split("\n").reduce(function(e,t,n){return n===r.line-1?e+"<mark>"+u(a(t,r.column-1),n+1)+"\n"+"</mark>":e+u(t,n+1)+"\n"},"<pre><div style='color: red'># ERROR on line "+r.line+", column "+r.column+" - "+r.message+"</div>")+"</pre>"}}function c(e,t,n){var r={pathname:"index.html"},o=document.createElement("a");return o.setAttribute("href",s.getConfig().clickURL+i.toLocationString(r,e,t)),o.setAttribute("id",n+"link"),o.setAttribute("style","text-decoration: none;"),o.setAttribute("title","click to edit in the mscgen_js interpreter"),o}function h(e,t){if(""===e.id||null===e.id||undefined===e.id)e.id=s.getConfig().parentElementPrefix+t.toString()}function p(e){var t=e.getAttribute("data-language");if(undefined===t||null===t)t=s.getConfig().defaultLanguage;return t}function d(n,r){var i={};try{"msgenny"===r?i=t.parse(n):"json"===r?i=JSON.parse(n):i=e.parse(n)}catch(s){return s}return i}function v(e,t,r,i){var o=document.getElementById(t);o.innerHTML="",!0===s.getConfig().clickable&&(o.appendChild(c(r,i,t)),t+="link"),n.clean(t,window),n.renderAST(e,r,t,window)}o()}),n("mscgen-inpage",function(){})})();